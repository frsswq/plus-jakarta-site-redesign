import{c as N,a as te}from"./g.CclMkshr.js";var X={exports:{}},Y={};/**
 * q5.js
 * @version 2.17
 * @author quinton-ashley, Tezumie, and LingDong-
 * @license LGPL-3.0
 * @class Q5
 */var Z;function $(){if(Z)return Y;Z=1;function n(e,o,i){let r=this;r._q5=!0,r._parent=o,i=="webgpu-fallback"?(r._webgpuFallback=!0,r._renderer="c2d"):r._renderer=i||n.render,r._preloadCount=0;let t=e=="auto";if(e??="global",e=="auto"){if(!(window.setup||window.update||window.draw))return;e="global"}r._scope=e;let a;e=="global"&&(n._hasGlobal=r._isGlobal=!0,a=n._esm?globalThis:n._server?N:window);let s=new Proxy(r,{set:(w,m,b)=>(r[m]=b,r._isGlobal&&(a[m]=b),!0)});r.canvas=r.ctx=r.drawingContext=null,r.pixels=[];let d=null;r.frameCount=0,r.deltaTime=16,r._targetFrameRate=0,r._targetFrameDuration=16.666666666666668,r._frameRate=r._fps=60,r._loop=!0,r._hooks={postCanvas:[],preRender:[],postRender:[]};let c=0;r.millis=()=>performance.now()-c,r.noCanvas=()=>{r.canvas?.remove&&r.canvas.remove(),r.canvas=0,s.ctx=s.drawingContext=0},window&&(r.windowWidth=window.innerWidth,r.windowHeight=window.innerHeight,r.deviceOrientation=window.screen?.orientation?.type),r._incrementPreload=()=>s._preloadCount++,r._decrementPreload=()=>s._preloadCount--,r.disablePreloadSystem=()=>r._disablePreload=!0,r._draw=w=>{let m=w||performance.now();if(r._lastFrameTime??=m-r._targetFrameDuration,r._didResize&&(r.windowResized(),r._didResize=!1),r._loop)d=l(r._draw);else if(r.frameCount&&!r._redraw)return;if(d&&r.frameCount&&m-r._lastFrameTime<r._targetFrameDuration-4)return;s.deltaTime=m-r._lastFrameTime,r._frameRate=1e3/r.deltaTime,s.frameCount++;let b=performance.now();r.resetMatrix(),r._beginRender&&r._beginRender();for(let x of n.methods.pre)x.call(r);try{r.draw()}catch(x){throw!n.disableFriendlyErrors&&r._askAI&&r._askAI(x),n.errorTolerant||r.noLoop(),x}for(let x of n.methods.post)x.call(r);r._render&&r._render(),r._finishRender&&r._finishRender(),r.postProcess(),s.pmouseX=r.mouseX,s.pmouseY=r.mouseY,s.moveX=s.moveY=0,r._lastFrameTime=m;let S=performance.now();r._fps=Math.round(1e3/(S-b))},r.noLoop=()=>{r._loop=!1,d=null},r.loop=()=>{r._loop=!0,r._setupDone&&d==null&&r._draw()},r.isLooping=()=>r._loop,r.redraw=(w=1)=>{r._redraw=!0;for(let m=0;m<w;m++)r._draw();r._redraw=!1},r.remove=()=>{r.noLoop(),r.canvas.remove()},r.frameRate=w=>(w&&(r._targetFrameRate=w,r._targetFrameDuration=1e3/w),r._frameRate),r.getTargetFrameRate=()=>r._targetFrameRate||60,r.getFPS=()=>r._fps,r.Element=function(w){this.elt=w},r._elements=[],r.describe=()=>{},r.log=r.print=console.log;for(let w in n.modules)n.modules[w](r,s);let p=n.renderers[r._renderer];for(let w in p)p[w](r,s);for(let w in n)w[1]!="_"&&w[1]==w[1].toUpperCase()&&(r[w]=n[w]);if(e=="graphics")return;e=="global"&&(Object.assign(n,r),delete n.Q5),r._webgpuFallback&&r.colorMode("rgb",1);for(let w of n.methods.init)w.call(r);for(let[w,m]of Object.entries(n.prototype))w[0]!="_"&&typeof r[w]=="function"&&(r[w]=m.bind(r));if(e=="global"){let w=Object.getOwnPropertyNames(r);for(let m of w)m[0]!="_"&&(a[m]=r[m])}typeof e=="function"&&e(r),n._instanceCount++;let l=window.requestAnimationFrame||function(w){const m=r._lastFrameTime+r._targetFrameDuration;return setTimeout(()=>{w(m)},m-performance.now())},f=a||r;r._isTouchAware=f.touchStarted||f.touchMoved||f.mouseReleased,r._isGlobal&&(r.preload=f.preload,r.setup=f.setup,r.draw=f.draw,r.postProcess=f.postProcess),r.preload??=()=>{},r.setup??=()=>{},r.draw??=()=>{},r.postProcess??=()=>{};let g=["mouseMoved","mousePressed","mouseReleased","mouseDragged","mouseClicked","mouseWheel","keyPressed","keyReleased","keyTyped","touchStarted","touchMoved","touchEnded","windowResized"];for(let w of g)f[w]?r._isGlobal&&(r[w]=m=>{try{return f[w](m)}catch(b){throw r._askAI&&r._askAI(b),b}}):r[w]=()=>{};async function _(){if(r._startDone=!0,r._preloadCount>0)return l(_);c=performance.now(),await r.setup(),r._setupDone=!0,!r.frameCount&&(r.ctx===null&&r.createCanvas(200,200),l(r._draw))}function y(){try{r.preload(),r._startDone||_()}catch(w){throw r._askAI&&r._askAI(w),w}}t?y():setTimeout(y,32)}n.render="c2d",n.renderers={},n.modules={},n._server=typeof process=="object",n._esm=Y===void 0,n._instanceCount=0,n._friendlyError=(e,o)=>{n.disableFriendlyErrors||console.error(o+": "+e)},n._validateParameters=()=>!0,n.methods={init:[],pre:[],post:[],remove:[]},n.prototype.registerMethod=(e,o)=>n.methods[e].push(o),n.prototype.registerPreloadMethod=(e,o)=>n.prototype[e]=o[e],n._server&&(N.p5??=N.Q5=n),typeof window=="object"?window.p5??=window.Q5=n:N.window=0,n.version=n.VERSION="2.17",typeof document=="object"&&document.addEventListener("DOMContentLoaded",()=>{n._hasGlobal||new n("auto")}),n.modules.canvas=(e,o)=>{e._OffscreenCanvas=window.OffscreenCanvas||function(){return document.createElement("canvas")},n._server?n._createServerCanvas&&(o.canvas=n._createServerCanvas(100,100)):(e._scope=="image"||e._scope=="graphics")&&(o.canvas=new e._OffscreenCanvas(100,100)),e.canvas||(typeof document=="object"?(o.canvas=document.createElement("canvas"),e.canvas.id="q5Canvas"+n._instanceCount,e.canvas.classList.add("q5Canvas")):e.noCanvas());let i=e.canvas;e.width=200,e.height=200,e._pixelDensity=1,e.displayDensity=()=>window.devicePixelRatio||1,i&&(i.width=200,i.height=200,e._scope!="image"&&(i.renderer=e._renderer,i[e._renderer]=!0,e._pixelDensity=Math.ceil(e.displayDensity()))),e._adjustDisplay=()=>{i.style&&(i.style.width=i.w+"px",i.style.height=i.h+"px")},e.createCanvas=function(t,a,s){typeof t=="object"&&(s=t,t=null),s??=arguments[3];let d=Object.assign({},n.canvasOptions);if(typeof s=="object"&&Object.assign(d,s),e._scope!="image"){if(e._scope=="graphics")e._pixelDensity=this._pixelDensity;else if(window.IntersectionObserver){let p=!1;new IntersectionObserver(l=>{i.visible=l[0].isIntersecting,p||(e._wasLooping=e._loop,p=!0),i.visible?e._wasLooping&&!e._loop&&e.loop():(e._wasLooping=e._loop,e.noLoop())}).observe(i)}}e._setCanvasSize(t,a),Object.assign(i,d);let c=e._createCanvas(i.w,i.h,d);if(e._hooks)for(let p of e._hooks.postCanvas)p();return e._beginRender&&e._beginRender(),c},e.createGraphics=function(t,a,s){let d=new n("graphics");return s??={},s.alpha??=!0,s.colorSpace??=e.canvas.colorSpace,d.createCanvas.call(e,t,a,s),d.defaultWidth=t,d.defaultHeight=a,d};async function r(t,a,s){if(a=a||"untitled",s=s||"png",s=="jpg"||s=="png"||s=="webp")if(t instanceof OffscreenCanvas){const c=await t.convertToBlob({type:"image/"+s});t=await new Promise(p=>{const l=new FileReader;l.onloadend=()=>p(l.result),l.readAsDataURL(c)})}else t=t.toDataURL("image/"+s);else{let c="text/plain";s=="json"&&(typeof t!="string"&&(t=JSON.stringify(t)),c="text/json"),t=new Blob([t],{type:c}),t=URL.createObjectURL(t)}let d=document.createElement("a");d.href=t,d.download=a+"."+s,d.click(),URL.revokeObjectURL(d.href)}if(e.save=(t,a,s)=>{if((!t||typeof t=="string"&&(!a||!s&&a.length<5))&&(s=a,a=t,t=e.canvas),s)return r(t,a,s);a?(a=a.split("."),r(t,a[0],a.at(-1))):r(t)},e._setCanvasSize=(t,a)=>{t?a??=t:a??=window.innerHeight,t??=window.innerWidth,e.defaultWidth=i.w=t=Math.ceil(t),e.defaultHeight=i.h=a=Math.ceil(a),i.hw=t/2,i.hh=a/2,i.width=Math.ceil(t*e._pixelDensity),i.height=Math.ceil(a*e._pixelDensity),e._da?e.flexibleCanvas(e._dau):(o.width=t,o.height=a),e.displayMode&&!i.displayMode?e.displayMode():e._adjustDisplay()},e._setImageSize=(t,a)=>{o.width=i.w=t,o.height=i.h=a,i.hw=t/2,i.hh=a/2,i.width=Math.ceil(t*e._pixelDensity),i.height=Math.ceil(a*e._pixelDensity)},e.defaultImageScale=t=>t?e._defaultImageScale=t:e._defaultImageScale,e.defaultImageScale(.5),e._scope!="image"){if(i&&e._scope!="graphics"){let t=function(){let a=e._parent;a??=document.getElementsByTagName("main")[0],a||(a=document.createElement("main"),document.body.append(a)),i.parent(a)};i.parent=a=>{i.parentElement&&i.parentElement.removeChild(i),typeof a=="string"&&(a=document.getElementById(a)),a.append(i);function s(){e.frameCount>1&&(e._didResize=!0,e._adjustDisplay())}typeof ResizeObserver=="function"?(e._ro&&e._ro.disconnect(),e._ro=new ResizeObserver(s),e._ro.observe(a)):e.frameCount||window.addEventListener("resize",s)},document.body?t():document.addEventListener("DOMContentLoaded",t)}e.resizeCanvas=(t,a)=>{if(!e.ctx)return e.createCanvas(t,a);t==i.w&&a==i.h||e._resizeCanvas(t,a)},i&&!n._createServerCanvas&&(i.resize=e.resizeCanvas,i.save=e.saveCanvas=e.save),e.pixelDensity=t=>!t||t==e._pixelDensity?e._pixelDensity:(e._pixelDensity=t,e._setCanvasSize(i.w,i.h),t),e.flexibleCanvas=(t=400)=>{t?(e._da=i.width/(t*e._pixelDensity),o.width=e._dau=t,o.height=i.h/i.w*t):e._da=0},e._styleNames=["_fill","_stroke","_strokeWeight","_doStroke","_doFill","_strokeSet","_fillSet","_shadow","_doShadow","_shadowOffsetX","_shadowOffsetY","_shadowBlur","_tint","_imageMode","_rectMode","_ellipseMode","_textSize","_textAlign","_textBaseline"],e._styles=[],e.pushStyles=()=>{let t={};for(let a of e._styleNames)t[a]=e[a];e._styles.push(t)},e.popStyles=()=>{let t=e._styles.pop();for(let a of e._styleNames)e[a]=t[a]},window&&e._scope!="graphics"&&window.addEventListener("resize",()=>{e._didResize=!0,o.windowWidth=window.innerWidth,o.windowHeight=window.innerHeight,o.deviceOrientation=window.screen?.orientation?.type})}},n.CENTER="center",n.LEFT="left",n.RIGHT="right",n.TOP="top",n.BOTTOM="bottom",n.BASELINE="alphabetic",n.MIDDLE="middle",n.NORMAL="normal",n.ITALIC="italic",n.BOLD="bold",n.BOLDITALIC="italic bold",n.ROUND="round",n.SQUARE="butt",n.PROJECT="square",n.MITER="miter",n.BEVEL="bevel",n.CHORD_OPEN=0,n.PIE_OPEN=1,n.PIE=2,n.CHORD=3,n.RADIUS="radius",n.CORNER="corner",n.CORNERS="corners",n.OPEN=0,n.CLOSE=1,n.LANDSCAPE="landscape",n.PORTRAIT="portrait",n.BLEND="source-over",n.REMOVE="destination-out",n.ADD="lighter",n.DARKEST="darken",n.LIGHTEST="lighten",n.DIFFERENCE="difference",n.SUBTRACT="subtract",n.EXCLUSION="exclusion",n.MULTIPLY="multiply",n.SCREEN="screen",n.REPLACE="copy",n.OVERLAY="overlay",n.HARD_LIGHT="hard-light",n.SOFT_LIGHT="soft-light",n.DODGE="color-dodge",n.BURN="color-burn",n.THRESHOLD=1,n.GRAY=2,n.OPAQUE=3,n.INVERT=4,n.POSTERIZE=5,n.DILATE=6,n.ERODE=7,n.BLUR=8,n.SEPIA=9,n.BRIGHTNESS=10,n.SATURATION=11,n.CONTRAST=12,n.HUE_ROTATE=13,n.P2D="2d",n.WEBGL="webgl",n.canvasOptions={alpha:!1,colorSpace:"display-p3"},!window.matchMedia||!matchMedia("(dynamic-range: high) and (color-gamut: p3)").matches?n.canvasOptions.colorSpace="srgb":n.supportsHDR=!0,n.renderers.c2d={},n.renderers.c2d.canvas=(e,o)=>{let i=e.canvas;if(e.colorMode&&e.colorMode(n.canvasOptions.colorSpace!="srgb"?"rgb":"srgb",255),e._createCanvas=function(t,a,s){if(!i){console.error("q5 canvas could not be created. skia-canvas and jsdom packages not found.");return}return o.ctx=o.drawingContext=i.getContext("2d",s),e._scope!="image"&&(e.ctx.fillStyle=e._fill="white",e.ctx.strokeStyle=e._stroke="black",e.ctx.lineCap="round",e.ctx.lineJoin="miter",e.ctx.textAlign="left",e._strokeWeight=1),e.ctx.scale(e._pixelDensity,e._pixelDensity),e.ctx.save(),i},e.clear=()=>{e.ctx.save(),e.ctx.resetTransform(),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.restore()},e._scope=="image")return;e._resizeCanvas=(t,a)=>{let s={};for(let c in e.ctx)typeof e.ctx[c]!="function"&&(s[c]=e.ctx[c]);delete s.canvas;let d;e.frameCount>1&&(d=new e._OffscreenCanvas(i.width,i.height),d.w=i.w,d.h=i.h,d.getContext("2d").drawImage(i,0,0)),e._setCanvasSize(t,a);for(let c in s)e.ctx[c]=s[c];e.scale(e._pixelDensity),d&&e.ctx.drawImage(d,0,0,d.w,d.h)},e.fill=function(t){if(e._doFill=e._fillSet=!0,n.Color&&(t._q5Color||(typeof t!="string"?t=e.color(...arguments):e._namedColors[t]&&(t=e.color(...e._namedColors[t]))),t.a<=0))return e._doFill=!1;e.ctx.fillStyle=e._fill=t.toString()},e.stroke=function(t){if(e._doStroke=e._strokeSet=!0,n.Color&&(t._q5Color||(typeof t!="string"?t=e.color(...arguments):e._namedColors[t]&&(t=e.color(...e._namedColors[t]))),t.a<=0))return e._doStroke=!1;e.ctx.strokeStyle=e._stroke=t.toString()},e.strokeWeight=t=>{t||(e._doStroke=!1),e._da&&(t*=e._da),e.ctx.lineWidth=e._strokeWeight=t||1e-4},e.noFill=()=>e._doFill=!1,e.noStroke=()=>e._doStroke=!1,e.opacity=t=>e.ctx.globalAlpha=t,e._doShadow=!1,e._shadowOffsetX=e._shadowOffsetY=e._shadowBlur=10,e.shadow=function(t){n.Color&&(t._q5Color||(typeof t!="string"?t=e.color(...arguments):e._namedColors[t]&&(t=e.color(...e._namedColors[t])))),e.ctx.shadowColor=e._shadow=t.toString(),e._doShadow=!0,e.ctx.shadowOffsetX||=e._shadowOffsetX,e.ctx.shadowOffsetY||=e._shadowOffsetY,e.ctx.shadowBlur||=e._shadowBlur},e.shadowBox=(t,a,s)=>{e.ctx.shadowOffsetX=e._shadowOffsetX=t,e.ctx.shadowOffsetY=e._shadowOffsetY=a||t,e.ctx.shadowBlur=e._shadowBlur=s||0},e.noShadow=()=>{e._doShadow=!1,e.ctx.shadowOffsetX=e.ctx.shadowOffsetY=e.ctx.shadowBlur=0},e.translate=(t,a)=>{e._da&&(t*=e._da,a*=e._da),e.ctx.translate(t,a)},e.rotate=t=>{e._angleMode&&(t=e.radians(t)),e.ctx.rotate(t)},e.scale=(t,a)=>{t.x&&(a=t.y,t=t.x),a??=t,e.ctx.scale(t,a)},e.applyMatrix=(t,a,s,d,c,p)=>e.ctx.transform(t,a,s,d,c,p),e.shearX=t=>e.ctx.transform(1,0,e.tan(t),1,0,0),e.shearY=t=>e.ctx.transform(1,e.tan(t),0,1,0,0),e.resetMatrix=()=>{e.ctx&&(e.ctx.resetTransform(),e.scale(e._pixelDensity),e._webgpuFallback&&e.translate(e.canvas.hw,e.canvas.hh))},e.pushMatrix=()=>e.ctx.save(),e.popMatrix=()=>e.ctx.restore();let r=e.popStyles;e.popStyles=()=>{r(),e.ctx.fillStyle=e._fill,e.ctx.strokeStyle=e._stroke,e.ctx.lineWidth=e._strokeWeight,e.ctx.shadowColor=e._shadow,e.ctx.shadowOffsetX=e._doShadow?e._shadowOffsetX:0,e.ctx.shadowOffsetY=e._doShadow?e._shadowOffsetY:0,e.ctx.shadowBlur=e._doShadow?e._shadowBlur:0},e.push=()=>{e.ctx.save(),e.pushStyles()},e.pop=()=>{e.ctx.restore(),r()},e.createCapture=t=>{var a=document.createElement("video");return a.playsinline="playsinline",a.autoplay="autoplay",navigator.mediaDevices.getUserMedia(t).then(s=>{a.srcObject=s}),a.style.position="absolute",a.style.opacity=1e-5,a.style.zIndex=-1e3,document.body.append(a),a}},n.renderers.c2d.drawing=e=>{e._doStroke=!0,e._doFill=!0,e._strokeSet=!1,e._fillSet=!1,e._ellipseMode=n.CENTER,e._rectMode=n.CORNER,e._curveDetail=20,e._curveAlpha=0;let o=!0,i=[];function r(){e._doFill&&e.ctx.fill(),e._doStroke&&e.ctx.stroke()}e.blendMode=p=>e.ctx.globalCompositeOperation=p,e.strokeCap=p=>e.ctx.lineCap=p,e.strokeJoin=p=>e.ctx.lineJoin=p,e.ellipseMode=p=>e._ellipseMode=p,e.rectMode=p=>e._rectMode=p,e.curveDetail=p=>e._curveDetail=p,e.curveAlpha=p=>e._curveAlpha=p,e.curveTightness=p=>e._curveAlpha=p,e.background=function(p){e.ctx.save(),e.ctx.resetTransform(),e.ctx.globalAlpha=1,p.canvas?e.image(p,0,0,e.canvas.width,e.canvas.height):(n.Color&&!p._q5Color&&(typeof p!="string"?p=e.color(...arguments):e._namedColors[p]&&(p=e.color(...e._namedColors[p]))),e.ctx.fillStyle=p.toString(),e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height)),e.ctx.restore()},e.line=(p,l,f,g)=>{e._doStroke&&(e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da),e.ctx.beginPath(),e.ctx.moveTo(p,l),e.ctx.lineTo(f,g),e.ctx.stroke())};const t=Math.PI*2;function a(p,l,f,g,_,y,w){if(e._angleMode&&(_=e.radians(_),y=e.radians(y)),_%=t,y%=t,_<0&&(_+=t),y<0&&(y+=t),_>y&&(y+=t),_==y)return e.ellipse(p,l,f,g);if(f/=2,g/=2,!e._doFill&&w==e.PIE_OPEN&&(w=e.CHORD_OPEN),e.ctx.beginPath(),e.ctx.ellipse(p,l,f,g,0,_,y),(w==e.PIE||w==e.PIE_OPEN)&&e.ctx.lineTo(p,l),e._doFill&&e.ctx.fill(),e._doStroke){if((w==e.PIE||w==e.CHORD)&&e.ctx.closePath(),w!=e.PIE_OPEN)return e.ctx.stroke();e.ctx.beginPath(),e.ctx.ellipse(p,l,f,g,0,_,y),e.ctx.stroke()}}e.arc=(p,l,f,g,_,y,w)=>{if(_==y)return e.ellipse(p,l,f,g);e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da),w??=e.PIE_OPEN,e._ellipseMode==e.CENTER?a(p,l,f,g,_,y,w):e._ellipseMode==e.RADIUS?a(p,l,f*2,g*2,_,y,w):e._ellipseMode==e.CORNER?a(p+f/2,l+g/2,f,g,_,y,w):e._ellipseMode==e.CORNERS&&a((p+f)/2,(l+g)/2,f-p,g-l,_,y,w)};function s(p,l,f,g){e.ctx.beginPath(),e.ctx.ellipse(p,l,f/2,g/2,0,0,t),r()}e.ellipse=(p,l,f,g)=>{g??=f,e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da),e._ellipseMode==e.CENTER?s(p,l,f,g):e._ellipseMode==e.RADIUS?s(p,l,f*2,g*2):e._ellipseMode==e.CORNER?s(p+f/2,l+g/2,f,g):e._ellipseMode==e.CORNERS&&s((p+f)/2,(l+g)/2,f-p,g-l)},e.circle=(p,l,f)=>{e._ellipseMode==e.CENTER?(e._da&&(p*=e._da,l*=e._da,f*=e._da),e.ctx.beginPath(),e.ctx.arc(p,l,f/2,0,t),r()):e.ellipse(p,l,f,f)},e.point=(p,l)=>{e._doStroke&&(p.x&&(l=p.y,p=p.x),e._da&&(p*=e._da,l*=e._da),e.ctx.beginPath(),e.ctx.moveTo(p,l),e.ctx.lineTo(p,l),e.ctx.stroke())};function d(p,l,f,g){e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da),e.ctx.beginPath(),e.ctx.rect(p,l,f,g),r()}function c(p,l,f,g,_,y,w,m){if(_===void 0)return d(p,l,f,g);if(y===void 0)return c(p,l,f,g,_,_,_,_);e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da,_*=e._da,y*=e._da,m*=e._da,w*=e._da),e.ctx.roundRect(p,l,f,g,[_,y,w,m]),r()}e.rect=(p,l,f,g=f,_,y,w,m)=>{e._rectMode==e.CENTER?c(p-f/2,l-g/2,f,g,_,y,w,m):e._rectMode==e.RADIUS?c(p-f,l-g,f*2,g*2,_,y,w,m):e._rectMode==e.CORNER?c(p,l,f,g,_,y,w,m):e._rectMode==e.CORNERS&&c(p,l,f-p,g-l,_,y,w,m)},e.square=(p,l,f,g,_,y,w)=>e.rect(p,l,f,f,g,_,y,w),e.beginShape=()=>{i=[],e.ctx.beginPath(),o=!0},e.beginContour=()=>{e.ctx.closePath(),i=[],o=!0},e.endContour=()=>{i=[],o=!0},e.vertex=(p,l)=>{e._da&&(p*=e._da,l*=e._da),i=[],o?e.ctx.moveTo(p,l):e.ctx.lineTo(p,l),o=!1},e.bezierVertex=(p,l,f,g,_,y)=>{e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da,_*=e._da,y*=e._da),i=[],e.ctx.bezierCurveTo(p,l,f,g,_,y)},e.quadraticVertex=(p,l,f,g)=>{e._da&&(p*=e._da,l*=e._da,f*=e._da,g*=e._da),i=[],e.ctx.quadraticCurveTo(p,l,f,g)},e.bezier=(p,l,f,g,_,y,w,m)=>{e.beginShape(),e.vertex(p,l),e.bezierVertex(f,g,_,y,w,m),e.endShape()},e.triangle=(p,l,f,g,_,y)=>{e.beginShape(),e.vertex(p,l),e.vertex(f,g),e.vertex(_,y),e.endShape(e.CLOSE)},e.quad=(p,l,f,g,_,y,w,m)=>{e.beginShape(),e.vertex(p,l),e.vertex(f,g),e.vertex(_,y),e.vertex(w,m),e.endShape(e.CLOSE)},e.endShape=p=>{i=[],p&&e.ctx.closePath(),r()},e.curveVertex=(p,l)=>{if(e._da&&(p*=e._da,l*=e._da),i.push([p,l]),i.length<4)return;let f=i.at(-4),g=i.at(-3),_=i.at(-2),y=i.at(-1),w=g[0]+(_[0]-f[0])/6,m=g[1]+(_[1]-f[1])/6,b=_[0]-(y[0]-g[0])/6,S=_[1]-(y[1]-g[1])/6;o&&(e.ctx.moveTo(g[0],g[1]),o=!1),e.ctx.bezierCurveTo(w,m,b,S,_[0],_[1])},e.curve=(p,l,f,g,_,y,w,m)=>{e.beginShape(),e.curveVertex(p,l),e.curveVertex(f,g),e.curveVertex(_,y),e.curveVertex(w,m),e.endShape()},e.curvePoint=(p,l,f,g,_)=>{const y=_*_*_,w=_*_,m=-.5*y+w-.5*_,b=1.5*y-2.5*w+1,S=-1.5*y+2*w+.5*_,x=.5*y-.5*w;return p*m+l*b+f*S+g*x},e.bezierPoint=(p,l,f,g,_)=>{const y=1-_;return Math.pow(y,3)*p+3*Math.pow(y,2)*_*l+3*y*Math.pow(_,2)*f+Math.pow(_,3)*g},e.curveTangent=(p,l,f,g,_)=>{const y=_*_,w=-3*y/2+2*_-.5,m=9*y/2-5*_,b=-9*y/2+4*_+.5,S=3*y/2-_;return p*w+l*m+f*b+g*S},e.bezierTangent=(p,l,f,g,_)=>{const y=1-_;return 3*g*Math.pow(_,2)-3*f*Math.pow(_,2)+6*f*y*_-6*l*y*_+3*l*Math.pow(y,2)-3*p*Math.pow(y,2)},e.erase=function(p=255,l=255){e.ctx.save(),e.ctx.globalCompositeOperation="destination-out",e.ctx.fillStyle=`rgba(0, 0, 0, ${p/255})`,e.ctx.strokeStyle=`rgba(0, 0, 0, ${l/255})`},e.noErase=function(){e.ctx.globalCompositeOperation="source-over",e.ctx.restore()},e.inFill=(p,l)=>{const f=e._pixelDensity;return e.ctx.isPointInPath(p*f,l*f)},e.inStroke=(p,l)=>{const f=e._pixelDensity;return e.ctx.isPointInStroke(p*f,l*f)}},n.renderers.c2d.image=(e,o)=>{class i{constructor(a,s,d){let c=this;c._scope="image",c.canvas=c.ctx=c.drawingContext=null,c.pixels=[],n.modules.canvas(c,c);let p=n.renderers.c2d;for(let l of["canvas","image","soft_filters"])p[l]&&p[l](c,c);c._pixelDensity=d.pixelDensity||1,c.createCanvas(a,s,d),delete c.createCanvas,c._loop=!1}get w(){return this.width}get h(){return this.height}}n.Image??=i,e._tint=null;let r=null;e.createImage=(t,a,s)=>{s??={},s.alpha??=!0,s.colorSpace??=e.canvas.colorSpace||n.canvasOptions.colorSpace;let d=new n.Image(t,a,s);return d.defaultWidth=t*e._defaultImageScale,d.defaultHeight=a*e._defaultImageScale,d},e.loadImage=function(t,a,s){if(t.canvas)return t;if(t.slice(-3).toLowerCase()=="gif")throw new Error("q5 doesn't support GIFs. Use a video or p5play animation instead. https://github.com/q5js/q5.js/issues/84");o._preloadCount++;let d=[...arguments].at(-1);typeof d=="object"?(s=d,a=null):s=null;let c=e.createImage(1,1,s),p=c._pixelDensity=s?.pixelDensity||1,l=new window.Image;return l.crossOrigin="Anonymous",c._loader=new Promise((f,g)=>{l.onload=()=>{l._pixelDensity=p,c.defaultWidth=l.width*e._defaultImageScale,c.defaultHeight=l.height*e._defaultImageScale,c.naturalWidth=l.naturalWidth||l.width,c.naturalHeight=l.naturalHeight||l.height,c._setImageSize(Math.ceil(c.naturalWidth/p),Math.ceil(c.naturalHeight/p)),c.ctx.drawImage(l,0,0),o._preloadCount--,a&&a(c),delete c._loader,f(c)},l.onerror=_=>{o._preloadCount--,g(_)}}),l.src=t,e._disablePreload?c._loader:c},e.imageMode=t=>e._imageMode=t,e.image=(t,a,s,d,c,p=0,l=0,f,g)=>{if(!t)return;let _=t.canvas||t;d??=t.defaultWidth||_.width||t.videoWidth,c??=t.defaultHeight||_.height||t.videoHeight,e._imageMode=="center"&&(a-=d*.5,s-=c*.5),e._da&&(a*=e._da,s*=e._da,d*=e._da,c*=e._da,p*=e._da,l*=e._da,f*=e._da,g*=e._da);let y=t._pixelDensity||1;if(f?f*=y:f=_.width||_.videoWidth,g?g*=y:g=_.height||_.videoHeight,e._tint){if(t._retint||t._tint!=e._tint){t._tintImg??=e.createImage(t.w,t.h,{pixelDensity:y}),(t._tintImg.width!=t.width||t._tintImg.height!=t.height)&&t._tintImg.resize(t.w,t.h);let w=t._tintImg.ctx;w.globalCompositeOperation="copy",w.fillStyle=e._tint,w.fillRect(0,0,t.width,t.height),t.canvas.alpha&&(w.globalCompositeOperation="destination-in",w.drawImage(_,0,0,t.width,t.height)),w.globalCompositeOperation="multiply",w.drawImage(_,0,0,t.width,t.height),t._tint=e._tint,t._retint=!1}_=t._tintImg.canvas}e.ctx.drawImage(_,p*y,l*y,f,g,a,s,d,c)},e.filter=(t,a)=>{e.ctx.save();let s="";if(e.ctx.filter){if(typeof t=="string")s=t;else if(t==n.GRAY)s="saturate(0%)";else if(t==n.INVERT)s="invert(100%)";else if(t==n.BLUR)s=`blur(${Math.ceil(a*e._pixelDensity)||1}px)`;else if(t==n.THRESHOLD)a??=.5,s=`saturate(0%) brightness(${Math.floor(.5/Math.max(a,1e-5)*100)}%) contrast(1000000%)`;else if(t==n.SEPIA)s=`sepia(${a??1})`;else if(t==n.BRIGHTNESS)s=`brightness(${a??1})`;else if(t==n.SATURATION)s=`saturate(${a??1})`;else if(t==n.CONTRAST)s=`contrast(${a??1})`;else if(t==n.HUE_ROTATE){let d=e._angleMode==0?"rad":"deg";s=`hue-rotate(${a}${d})`}if(s&&(e.ctx.filter=s,e.ctx.filter=="none"))throw new Error(`Invalid filter format: ${t}`)}s||e._softFilter(t,a),e.ctx.globalCompositeOperation="source-over",e.ctx.drawImage(e.canvas,0,0,e.canvas.w,e.canvas.h),e.ctx.restore(),e._retint=!0},e._scope=="image"&&(e.resize=(t,a)=>{let s=e.canvas,d=new e._OffscreenCanvas(s.width,s.height);d.getContext("2d",{colorSpace:s.colorSpace}).drawImage(s,0,0),e._setImageSize(t,a),e.defaultWidth=s.width*e._defaultImageScale,e.defaultHeight=s.height*e._defaultImageScale,e.ctx.clearRect(0,0,s.width,s.height),e.ctx.drawImage(d,0,0,s.width,s.height),e._retint=!0}),e._getImageData=(t,a,s,d)=>e.ctx.getImageData(t,a,s,d,{colorSpace:e.canvas.colorSpace}),e.trim=()=>{let t=e._pixelDensity||1,a=e.canvas.width,s=e.canvas.height,d=e._getImageData(0,0,a,s).data,c=a,p=0,l=s,f=0,g=3;for(let _=0;_<s;_++)for(let y=0;y<a;y++)d[g]!==0&&(y<c&&(c=y),y>p&&(p=y),_<l&&(l=_),_>f&&(f=_)),g+=4;return l=Math.floor(l/t),f=Math.floor(f/t),c=Math.floor(c/t),p=Math.floor(p/t),e.get(c,l,p-c+1,f-l+1)},e.mask=t=>{e.ctx.save(),e.ctx.resetTransform();let a=e.ctx.globalCompositeOperation;e.ctx.globalCompositeOperation="destination-in",e.ctx.drawImage(t.canvas,0,0),e.ctx.globalCompositeOperation=a,e.ctx.restore(),e._retint=!0},e.inset=(t,a,s,d,c,p,l,f)=>{let g=e._pixelDensity||1;e.ctx.drawImage(e.canvas,t*g,a*g,s*g,d*g,c,p,l,f),e._retint=!0},e.copy=()=>e.get(),e.get=(t,a,s,d)=>{let c=e._pixelDensity||1;if(t!==void 0&&s===void 0){let g=e._getImageData(t*c,a*c,1,1).data;return[g[0],g[1],g[2],g[3]/255]}t=Math.floor(t||0)*c,a=Math.floor(a||0)*c;let p=s=s||e.width,l=d=d||e.height;s*=c,d*=c;let f=e.createImage(s,d);return f.ctx.drawImage(e.canvas,t,a,s,d,0,0,s,d),f._pixelDensity=c,f.width=p,f.height=l,f},e.set=(t,a,s)=>{if(t=Math.floor(t),a=Math.floor(a),e._retint=!0,s.canvas){let c=e._tint;e._tint=null,e.image(s,t,a),e._tint=c;return}e.pixels.length||e.loadPixels();let d=e._pixelDensity||1;for(let c=0;c<d;c++)for(let p=0;p<d;p++){let l=4*((a*d+c)*e.canvas.width+t*d+p);e.pixels[l]=s.r,e.pixels[l+1]=s.g,e.pixels[l+2]=s.b,e.pixels[l+3]=s.a}},e.loadPixels=()=>{r=e._getImageData(0,0,e.canvas.width,e.canvas.height),o.pixels=r.data},e.updatePixels=()=>{r!=null&&(e.ctx.putImageData(r,0,0),e._retint=!0)},e.smooth=()=>e.ctx.imageSmoothingEnabled=!0,e.noSmooth=()=>e.ctx.imageSmoothingEnabled=!1,e._scope!="image"&&(e.tint=function(t){e._tint=(t._q5Color?t:e.color(...arguments)).toString()},e.noTint=()=>e._tint=null)},n.renderers.c2d.soft_filters=e=>{let o=null;function i(){let t=e.canvas.width*e.canvas.height*4;(!o||o.length!=t)&&(o=new Uint8ClampedArray(t))}function r(){e._filters=[],e._filters[n.THRESHOLD]=(t,a)=>{a===void 0?a=127.5:a*=255;for(let s=0;s<t.length;s+=4){const d=.2126*t[s]+.7152*t[s+1]+.0722*t[s+2];t[s]=t[s+1]=t[s+2]=d>=a?255:0}},e._filters[n.GRAY]=t=>{for(let a=0;a<t.length;a+=4){const s=.2126*t[a]+.7152*t[a+1]+.0722*t[a+2];t[a]=t[a+1]=t[a+2]=s}},e._filters[n.OPAQUE]=t=>{for(let a=0;a<t.length;a+=4)t[a+3]=255},e._filters[n.INVERT]=t=>{for(let a=0;a<t.length;a+=4)t[a]=255-t[a],t[a+1]=255-t[a+1],t[a+2]=255-t[a+2]},e._filters[n.POSTERIZE]=(t,a=4)=>{let s=a-1;for(let d=0;d<t.length;d+=4)t[d]=(t[d]*a>>8)*255/s,t[d+1]=(t[d+1]*a>>8)*255/s,t[d+2]=(t[d+2]*a>>8)*255/s},e._filters[n.DILATE]=(t,a)=>{a??=Math.max,i(),o.set(t);let[s,d]=[e.canvas.width,e.canvas.height];for(let c=0;c<d;c++)for(let p=0;p<s;p++){let l=4*Math.max(p-1,0),f=4*Math.min(p+1,s-1),g=4*Math.max(c-1,0)*s,_=4*Math.min(c+1,d-1)*s,y=4*c*s,w=4*p;for(let m=0;m<4;m++){let b=m+g,S=m+_,x=m+y;t[y+w+m]=a(o[b+w],o[x+l],o[x+w],o[x+f],o[S+w])}}},e._filters[n.ERODE]=t=>{e._filters[n.DILATE](t,Math.min)},e._filters[n.BLUR]=(t,a)=>{a=a||1,a=Math.floor(a*e._pixelDensity),i(),o.set(t);let s=a*2+1;function d(f){let g=new Float32Array(f),_=.3*a+.8,y=_*_*2;for(let w=0;w<f;w++){let m=w-f/2,b=Math.exp(-(m*m)/y)/(2.5066282746*_);g[w]=b}return g}let c=d(s),[p,l]=[e.canvas.width,e.canvas.height];for(let f=0;f<l;f++)for(let g=0;g<p;g++){let _=0,y=0,w=0,m=0;for(let S=0;S<s;S++){let x=Math.min(Math.max(g-a+S,0),p-1),v=4*(f*p+x);_+=o[v]*c[S],y+=o[v+1]*c[S],w+=o[v+2]*c[S],m+=o[v+3]*c[S]}let b=4*(f*p+g);t[b]=_,t[b+1]=y,t[b+2]=w,t[b+3]=m}o.set(t);for(let f=0;f<l;f++)for(let g=0;g<p;g++){let _=0,y=0,w=0,m=0;for(let S=0;S<s;S++){let v=4*(Math.min(Math.max(f-a+S,0),l-1)*p+g);_+=o[v]*c[S],y+=o[v+1]*c[S],w+=o[v+2]*c[S],m+=o[v+3]*c[S]}let b=4*(f*p+g);t[b]=_,t[b+1]=y,t[b+2]=w,t[b+3]=m}}}e._softFilter=(t,a)=>{e._filters||r();let s=e._getImageData(0,0,e.canvas.width,e.canvas.height);e._filters[t](s.data,a),e.ctx.putImageData(s,0,0)}},n.renderers.c2d.text=(e,o)=>{e._textAlign="left",e._textBaseline="alphabetic",e._textSize=12;let i="sans-serif",r=!1,t=15,a=3,s="normal",d=!1,c=0,p=[],l=!1,f=!1,g=0,_=12e3,y=e._textCache={};e.loadFont=(S,x)=>{o._preloadCount++;let v=S.split("/").pop().split(".")[0].replace(" ",""),E=new FontFace(v,`url(${S})`);return document.fonts.add(E),E._loader=(async()=>{let P;try{await E.load()}catch(u){P=u}if(o._preloadCount--,delete E._loader,P)throw P;return x&&x(E),E})(),e.textFont(v),e._disablePreload?E._loader:E},e.textFont=S=>{if(typeof S!="string"&&(S=S.family),!S||S==i)return i;i=S,d=!0,c=-1},e.textSize=S=>{if(S==null||S==e._textSize)return e._textSize;e._da&&(S*=e._da),e._textSize=S,d=!0,c=-1,r||(t=S*1.25,a=t-S)},e.textStyle=S=>{if(!S||S==s)return s;s=S,d=!0,c=-1},e.textLeading=S=>{if(S==null)return t||e._textSize*1.25;if(r=!0,S==t)return t;e._da&&(S*=e._da),t=S,a=S-e._textSize,c=-1},e.textAlign=(S,x)=>{e.ctx.textAlign=e._textAlign=S,x&&(e.ctx.textBaseline=e._textBaseline=x==e.CENTER?"middle":x)};const w=()=>{e.ctx.font=`${s} ${e._textSize}px ${i}`,d=!1};e.textWidth=S=>(d&&w(),e.ctx.measureText(S).width),e.textAscent=S=>(d&&w(),e.ctx.measureText(S).actualBoundingBoxAscent),e.textDescent=S=>(d&&w(),e.ctx.measureText(S).actualBoundingBoxDescent),e.textFill=e.fill,e.textStroke=e.stroke;let m=()=>{let S=i+e._textSize+s+t,x=5381;for(let v=0;v<S.length;v++)x=x*33^S.charCodeAt(v);c=x>>>0};e.textCache=(S,x)=>(x&&(_=x),S!==void 0&&(l=S),l),e.createTextImage=(S,x,v)=>(f=!0,img=e.text(S,0,0,x,v),f=!1,img);let b=[];e.text=(S,x,v,E,P)=>{if(S===void 0||!e._doFill&&!e._doStroke)return;S=S.toString(),e._da&&(x*=e._da,v*=e._da);let u=e.ctx,h,M,C;if(d&&(u.font=`${s} ${e._textSize}px ${i}`,d=!1),(l||f)&&(c==-1&&m(),h=y[S],h&&(h=h[c]),h)){if(h._fill==e._fill&&h._stroke==e._stroke&&h._strokeWeight==e._strokeWeight)return f?h:e.textImage(h,x,v);h.clear()}if(S.indexOf(`
`)==-1?b[0]=S:b=S.split(`
`),S.length>E){let R=[];for(let A of b){let T=0;for(;T<A.length;){let O=T+E;if(O>=A.length){R.push(A.slice(T));break}let F=A.lastIndexOf(" ",O);(F===-1||F<T)&&(F=O),R.push(A.slice(T,F)),T=F+1}}b=R}if(!l&&!f)M=x,C=v;else{if(M=0,C=t*b.length,!h){let R=u.measureText(" "),A=R.fontBoundingBoxAscent,T=R.fontBoundingBoxDescent;h=e.createImage.call(e,Math.ceil(u.measureText(S).width),Math.ceil(C+T),{pixelDensity:e._pixelDensity}),h._ascent=A,h._descent=T,h._top=T+a,h._middle=h._top+A*.5,h._bottom=h._top+A,h._leading=t}h._fill=e._fill,h._stroke=e._stroke,h._strokeWeight=e._strokeWeight,h.modified=!0,u=h.ctx,u.font=e.ctx.font,u.fillStyle=e._fill,u.strokeStyle=e._stroke,u.lineWidth=e.ctx.lineWidth}let I;e._fillSet||(I=u.fillStyle,u.fillStyle="black");let k=0;for(let R of b)if(e._doStroke&&e._strokeSet&&u.strokeText(R,M,C),e._doFill&&u.fillText(R,M,C),C+=t,k++,k>=P)break;if(b=[],e._fillSet||(u.fillStyle=I),l||f){if(p.push(c),(y[S]??={})[c]=h,g++,g>_){let R=Math.ceil(g/2),A=p.splice(0,R);for(let T in y){T=y[T];for(let O of A)delete T[O]}g-=R}if(f)return h;e.textImage(h,x,v)}},e.textImage=(S,x,v)=>{typeof S=="string"&&(S=e.createTextImage(S));let E=e._imageMode;e._imageMode="corner";let P=e._textAlign;P=="center"?x-=S.canvas.hw:P=="right"&&(x-=S.width);let u=e._textBaseline;u=="alphabetic"?v-=S._leading:u=="middle"?v-=S._middle:u=="bottom"?v-=S._bottom:u=="top"&&(v-=S._top),e.image(S,x,v),e._imageMode=E},e.nf=(S,x,v)=>{let E=S<0;S=Math.abs(S);let P=S.toFixed(v).split(".");P[0]=P[0].padStart(x,"0");let u=P.join(".");return E&&(u="-"+u),u}},n.modules.ai=e=>{e.askAI=(o="")=>{throw n.disableFriendlyErrors=!1,Error("Ask AI ✨ "+o)},e._askAI=async o=>{let i=o.message?.includes("Ask AI ✨"),r=o.stack?.split(`
`);if(!o.stack||r.length<=1)return;let t=1,a="(";for(navigator.userAgent.indexOf("Chrome")==-1&&(t=0,a="@");r[t].indexOf("q5")>=0;)t++;let s=r[t].split(a).at(-1);s.startsWith("blob:")&&(s=s.slice(5));let d=s.split(":"),c=parseInt(d.at(-2));i&&c++,d[3]=d[3].split(")")[0];let p=d.slice(0,2).join(":"),l=p.split("/").at(-1);try{let g=(await(await fetch(p)).text()).split(`
`),_=g[c-1].trim(),y="",w=1;for(;y.length<1600&&(c-w>=0&&(y=g[c-w].trim()+`
`+y),c+w<g.length);){y+=g[c+w].trim()+`
`;w++}let b="https://chatgpt.com/?q=q5.js+"+(i&&o.message.length>10?o.message.slice(10):"Whats+wrong+with+this+line%3F+short+answer")+(i?"":"%0A%0A"+encodeURIComponent(o.name+": "+o.message))+"%0A%0ALine%3A+"+encodeURIComponent(_)+"%0A%0AExcerpt+for+context%3A%0A%0A"+encodeURIComponent(y);if(console.warn("Error in "+l+" on line "+c+`:

`+_),console.warn("Ask AI ✨ "+b),i)return window.open(b,"_blank")}catch{}}},n.modules.color=(e,o)=>{e.RGB=e.RGBA=e._colorMode="rgb",e.SRGB="srgb",e.OKLCH="oklch",e.colorMode=(i,r)=>{e._colorMode=i;let t=e.canvas.colorSpace=="srgb"||i=="srgb";r??=t?"integer":"float",e._colorFormat=r=="float"||r==1?1:255,i=="oklch"?o.Color=n.ColorOKLCH:(e._colorFormat==255?o.Color=t?n.ColorRGBA_8:n.ColorRGBA_P3_8:o.Color=t?n.ColorRGBA:n.ColorRGBA_P3,e._colorMode="rgb")},e._namedColors={aqua:[0,255,255],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],crimson:[220,20,60],cyan:[0,255,255],darkviolet:[148,0,211],gold:[255,215,0],green:[0,128,0],gray:[128,128,128],grey:[128,128,128],hotpink:[255,105,180],indigo:[75,0,130],khaki:[240,230,140],lightgreen:[144,238,144],lime:[0,255,0],magenta:[255,0,255],navy:[0,0,128],orange:[255,165,0],olive:[128,128,0],peachpuff:[255,218,185],pink:[255,192,203],purple:[128,0,128],red:[255,0,0],skyblue:[135,206,235],tan:[210,180,140],turquoise:[64,224,208],transparent:[0,0,0,0],white:[255,255,255],violet:[238,130,238],yellow:[255,255,0]},e.color=(i,r,t,a)=>{let s=e.Color;if(i._q5Color)return new s(...i.levels);if(r==null){if(typeof i=="string"){if(i[0]=="#")i.length<=5?(i.length>4&&(a=parseInt(i[4]+i[4],16)),t=parseInt(i[3]+i[3],16),r=parseInt(i[2]+i[2],16),i=parseInt(i[1]+i[1],16)):(i.length>7&&(a=parseInt(i.slice(7,9),16)),t=parseInt(i.slice(5,7),16),r=parseInt(i.slice(3,5),16),i=parseInt(i.slice(1,3),16));else if(e._namedColors[i])[i,r,t,a]=e._namedColors[i];else{let d=new s(0,0,0);return d._css=i,d.toString=function(){return this._css},d}e._colorFormat==1&&(i/=255,r&&(r/=255),t&&(t/=255),a&&(a/=255))}Array.isArray(i)&&([i,r,t,a]=i)}return t==null?e._colorMode==n.OKLCH?new s(i,0,0,r):new s(i,i,i,r):new s(i,r,t,a)},e.red=i=>i.r,e.green=i=>i.g,e.blue=i=>i.b,e.alpha=i=>i.a,e.lightness=i=>i.l?i.l:(.2126*i.r+.7152*i.g+.0722*i.b)*100/255,e.hue=i=>{if(i.h)return i.h;let r=i.r,t=i.g,a=i.b;e._colorFormat==255&&(r/=255,t/=255,a/=255);let s=Math.max(r,t,a),d=Math.min(r,t,a),c;return s==d?c=0:s==r?c=60*(t-a)/(s-d):s==t?c=60*(a-r)/(s-d)+120:c=60*(r-t)/(s-d)+240,c<0&&(c+=360),c},e.lerpColor=(i,r,t)=>{if(t=Math.max(0,Math.min(1,t)),e._colorMode=="rgb")return new e.Color(e.lerp(i.r,r.r,t),e.lerp(i.g,r.g,t),e.lerp(i.b,r.b,t),e.lerp(i.a,r.a,t));{let a=r.h-i.h;a>180&&(a-=360),a<-180&&(a+=360);let s=i.h+t*a;return s<0&&(s+=360),s>360&&(s-=360),new e.Color(e.lerp(i.l,r.l,t),e.lerp(i.c,r.c,t),s,e.lerp(i.a,r.a,t))}}},n.Color=class{constructor(){this._q5Color=!0}},n.ColorOKLCH=class extends n.Color{constructor(e,o,i,r){super(),this.l=e,this.c=o,this.h=i,this.a=r??1}get levels(){return[this.l,this.c,this.h,this.a]}equals(e){return e&&this.l==e.l&&this.c==e.c&&this.h==e.h&&this.a==e.a}isSameColor(e){return e&&this.l==e.l&&this.c==e.c&&this.h==e.h}toString(){return`oklch(${this.l} ${this.c} ${this.h} / ${this.a})`}get lightness(){return this.l}set lightness(e){this.l=e}get chroma(){return this.c}set chroma(e){this.c=e}get hue(){return this.h}set hue(e){this.h=e}get alpha(){return this.a}set alpha(e){this.a=e}},n.ColorRGBA=class extends n.Color{constructor(e,o,i,r){super(),this.r=e,this.g=o,this.b=i,this.a=r??1}get levels(){return[this.r,this.g,this.b,this.a]}equals(e){return e&&this.r==e.r&&this.g==e.g&&this.b==e.b&&this.a==e.a}isSameColor(e){return e&&this.r==e.r&&this.g==e.g&&this.b==e.b}toString(){return`color(srgb ${this.r} ${this.g} ${this.b} / ${this.a})`}get red(){return this.r}set red(e){this.r=e}get green(){return this.g}set green(e){this.g=e}get blue(){return this.b}set blue(e){this.b=e}get alpha(){return this.a}set alpha(e){this.a=e}},n.ColorRGBA_P3=class extends n.ColorRGBA{toString(){return`color(display-p3 ${this.r} ${this.g} ${this.b} / ${this.a})`}},n.ColorRGBA_8=class extends n.ColorRGBA{constructor(e,o,i,r){super(e,o,i,r??255)}setRed(e){this.r=e}setGreen(e){this.g=e}setBlue(e){this.b=e}setAlpha(e){this.a=e}toString(){return`rgb(${this.r} ${this.g} ${this.b} / ${this.a/255})`}},n.ColorRGBA_P3_8=class extends n.ColorRGBA{constructor(e,o,i,r){super(e,o,i,r??255),this._edited=!0}get r(){return this._r}set r(e){this._r=e,this._edited=!0}get g(){return this._g}set g(e){this._g=e,this._edited=!0}get b(){return this._b}set b(e){this._b=e,this._edited=!0}get a(){return this._a}set a(e){this._a=e,this._edited=!0}toString(){if(this._edited){let e=(this._r/255).toFixed(3),o=(this._g/255).toFixed(3),i=(this._b/255).toFixed(3),r=(this._a/255).toFixed(3);this._css=`color(display-p3 ${e} ${o} ${i} / ${r})`,this._edited=!1}return this._css}},n.modules.display=e=>{if(!e.canvas||e._scope=="graphics")return;let o=e.canvas;e.CENTERED="centered",e.FULLSCREEN="fullscreen",e.MAXED="maxed",e.PIXELATED="pixelated",n._instanceCount==0&&!n._server&&document.head.insertAdjacentHTML("beforeend",`<style>
html, body {
	margin: 0;
	padding: 0;
}
.q5Canvas {
	outline: none;
	-webkit-touch-callout: none;
	-webkit-text-size-adjust: none;
	-webkit-user-select: none;
	overscroll-behavior: none;
}
.q5-pixelated {
	image-rendering: pixelated;
	font-smooth: never;
	-webkit-font-smoothing: none;
}
.q5-centered,
.q5-maxed,
.q5-fullscreen {
  display: flex;
	align-items: center;
	justify-content: center;
}
main.q5-centered,
main.q5-maxed,
.q5-fullscreen {
	height: 100vh;
}
main {
	overscroll-behavior: none;
}
</style>`),e._adjustDisplay=()=>{let i=o.style,r=o.parentElement;!i||!r||!o.displayMode||(o.renderQuality=="pixelated"&&(o.classList.add("q5-pixelated"),e.pixelDensity(1),e.defaultImageScale(1),e.noSmooth&&e.noSmooth(),e.textFont&&e.textFont("monospace")),o.displayMode=="default"||o.displayMode=="normal"?(r.classList.remove("q5-centered","q5-maxed","q5-fullscreen"),i.width=o.w*o.displayScale+"px",i.height=o.h*o.displayScale+"px"):(r.classList.add("q5-"+o.displayMode),r=r.getBoundingClientRect(),o.w/o.h>r.width/r.height?(o.displayMode=="centered"?(i.width=o.w*o.displayScale+"px",i.maxWidth="100%"):i.width="100%",i.height="auto",i.maxHeight=""):(i.width="auto",i.maxWidth="",o.displayMode=="centered"?(i.height=o.h*o.displayScale+"px",i.maxHeight="100%"):i.height="100%")))},e.displayMode=(i="normal",r="smooth",t=1)=>{typeof t=="string"&&(t=parseFloat(t.slice(1))),i=="center"&&(i="centered"),Object.assign(o,{displayMode:i,renderQuality:r,displayScale:t}),e.ctx&&e.pushStyles(),e._adjustDisplay(),e.ctx&&e.popStyles()},e.fullscreen=i=>{if(i===void 0)return document.fullscreenElement;i?document.body.requestFullscreen():document.body.exitFullscreen()}},n.modules.dom=e=>{e.elementMode=i=>e._elementMode=i,e.createElement=(i,r)=>{let t=document.createElement(i);return e._elementMode=="center"&&(t.style.transform="translate(-50%, -50%)"),r&&(t.innerHTML=r),Object.defineProperty(t,"x",{get:()=>t._x,set:a=>{let s=t.style.position;(!s||s=="relative")&&(t.style.position="absolute");let d=e.canvas.offsetLeft+a;t.style.left=d+"px",t._x=d}}),Object.defineProperty(t,"y",{get:()=>t._y,set:a=>{let s=t.style.position;(!s||s=="relative")&&(t.style.position="absolute");let d=e.canvas.offsetTop+a;t.style.top=d+"px",t._y=d}}),Object.defineProperty(t,"width",{get:()=>t.style.width,set:a=>t.style.width=a+"px"}),Object.defineProperty(t,"height",{get:()=>t.style.height,set:a=>t.style.height=a+"px"}),t.position=(a,s,d)=>(d&&(t.style.position=d),t.x=a,t.y=s,t),Object.defineProperty(t,"size",{writable:!0}),t.size=(a,s)=>(t.width=a,t.height=s,t),t.center=()=>(t.style.position="absolute",t.x=e.canvas.hw,t.y=e.canvas.hh,t),t.show=()=>(t.style.display="block",t),t.hide=()=>(t.style.display="none",t),t.parent=a=>(a.append(t),t),e._elements.push(t),e.canvas.parentElement.append(t),t},e.createEl=e.createElement,e.createA=(i,r,t)=>{let a=e.createEl("a",r);return a.href=i,a.target=t?"_blank":"_self",a},e.createButton=i=>e.createEl("button",i),e.createCheckbox=(i="",r=!1)=>{let t=e.createEl("input");t.type="checkbox",t.checked=r;let a=e.createEl("label",i);return a.addEventListener("click",()=>{t.checked=!t.checked,t.dispatchEvent(new Event("change",{bubbles:!0}))}),t.insertAdjacentElement("afterend",a),t.label=a,t},e.createColorPicker=(i="#ffffff")=>{let r=e.createEl("input");return r.type="color",r.value=i.toString(),r},e.createDiv=i=>e.createEl("div",i),e.createImg=i=>{let r=e.createEl("img");return r.crossOrigin="anonymous",r.src=i,r},e.createInput=(i="",r="text")=>{let t=e.createEl("input");return t.value=i,t.type=r,t.style.boxSizing="border-box",t},e.createP=i=>e.createEl("p",i);let o=0;e.createRadio=i=>{let r=e.createEl("div");return r.name=i||"radio"+o++,r.buttons=[],Object.defineProperty(r,"value",{get:()=>r.selected?.value,set:t=>{let a=r.buttons.find(s=>s.value==t);a&&(a.checked=!0,r.selected=a)}}),r.option=(t,a)=>{let s=e.createEl("input");s.type="radio",s.name=r.name,s.value=a||t,s.addEventListener("change",()=>r.selected=s);let d=e.createEl("label",t);return d.addEventListener("click",()=>{s.checked=!0,r.selected=s,s.dispatchEvent(new Event("change",{bubbles:!0}))}),s.label=d,r.append(s),r.append(d),r.buttons.push(s),r},r},e.createSelect=i=>{let r=e.createEl("select");if(i){let t=e.createEl("option",i);t.disabled=!0,t.selected=!0,r.append(t)}return Object.defineProperty(r,"selected",{get:()=>r.multiple?Array.from(r.selectedOptions):r.selectedOptions[0],set:t=>{r.multiple?r.options.forEach(a=>a.selected=t.includes(a)):t.selected=!0}}),Object.defineProperty(r,"value",{get:()=>r.multiple?Array.from(r.selectedOptions).map(t=>t.value):r.selectedOptions[0]?.value,set:t=>{if(r.multiple)r.options.forEach(a=>a.selected=t.includes(a.value));else{let a;for(let s=0;s<r.options.length;s++)if(r.options[s].value==t){a=r.options[s];break}a&&(a.selected=!0)}}}),r.option=(t,a)=>{let s=e.createEl("option",t);return s.value=a||t,r.append(s),r},r},e.createSlider=(i,r,t,a)=>{let s=e.createEl("input");return s.type="range",s.min=i,s.max=r,s.value=t,s.step=a,s.val=()=>parseFloat(s.value),s},e.createSpan=i=>e.createEl("span",i),e.createVideo=i=>{let r=e.createEl("video");return r.crossOrigin="anonymous",r.src=i,r},e.findElement=i=>document.querySelector(i),e.findElements=i=>document.querySelectorAll(i)},n.modules.input=(e,o)=>{if(e._scope=="graphics")return;e.mouseX=0,e.mouseY=0,e.pmouseX=0,e.pmouseY=0,e.touches=[],e.mouseButton="",e.keyIsPressed=!1,e.mouseIsPressed=!1,e.key="",e.keyCode=0,e.UP_ARROW=38,e.DOWN_ARROW=40,e.LEFT_ARROW=37,e.RIGHT_ARROW=39,e.SHIFT=16,e.TAB=9,e.BACKSPACE=8,e.ENTER=e.RETURN=13,e.ALT=e.OPTION=18,e.CONTROL=17,e.DELETE=46,e.ESCAPE=27,e.ARROW="default",e.CROSS="crosshair",e.HAND="pointer",e.MOVE="move",e.TEXT="text";let i={},r=[n.LEFT,n.CENTER,n.RIGHT],t=e.canvas;e._startAudio=()=>{(!n.aud||n.aud?.state!="running")&&e.userStartAudio()},e._updateMouse=d=>{if(!d.changedTouches){if(t){let c=t.getBoundingClientRect(),p=t.scrollWidth/e.width||1,l=t.scrollHeight/e.height||1;o.mouseX=(d.clientX-c.left)/p,o.mouseY=(d.clientY-c.top)/l,t.renderer=="webgpu"&&(o.mouseX-=t.hw,o.mouseY-=t.hh)}else o.mouseX=d.clientX,o.mouseY=d.clientY;o.moveX=d.movementX,o.moveY=d.movementY}};let a=0;e._onmousedown=d=>{a++,e._startAudio(),e._updateMouse(d),o.mouseIsPressed=!0,o.mouseButton=r[d.button],e.mousePressed(d)},e._onmousemove=d=>{e._updateMouse(d),e.mouseIsPressed?e.mouseDragged(d):e.mouseMoved(d)},e._onmouseup=d=>{e._updateMouse(d),o.mouseIsPressed=!1,e.mouseReleased(d)},e._onclick=d=>{e._updateMouse(d),o.mouseIsPressed=!0,e.mouseClicked(d),o.mouseIsPressed=!1},e._onwheel=d=>{e._updateMouse(d),d.delta=d.deltaY,e.mouseWheel(d)==!1&&d.preventDefault()},e.cursor=(d,c,p)=>{let l="";d.includes(".")&&(d=`url("${d}")`,l=", auto"),c!==void 0&&(d+=" "+c+" "+p),e.canvas.style.cursor=d+l},e.noCursor=()=>{e.canvas.style.cursor="none"},window&&(e.lockMouse=document.body?.requestPointerLock,e.unlockMouse=document.exitPointerLock),e._onkeydown=d=>{d.repeat||(e._startAudio(),o.keyIsPressed=!0,o.key=d.key,o.keyCode=d.keyCode,i[e.keyCode]=i[e.key.toLowerCase()]=!0,e.keyPressed(d),d.key.length==1&&e.keyTyped(d))},e._onkeyup=d=>{o.keyIsPressed=!1,o.key=d.key,o.keyCode=d.keyCode,i[e.keyCode]=i[e.key.toLowerCase()]=!1,e.keyReleased(d)},e.keyIsDown=d=>!!i[typeof d=="string"?d.toLowerCase():d];function s(d){const c=e.canvas.getBoundingClientRect(),p=e.canvas.scrollWidth/e.width||1,l=e.canvas.scrollHeight/e.height||1;return{x:(d.clientX-c.left)/p,y:(d.clientY-c.top)/l,id:d.identifier}}if(e._ontouchstart=d=>{e._startAudio(),o.touches=[...d.touches].map(s),e._isTouchAware||(o.mouseX=e.touches[0].x,o.mouseY=e.touches[0].y,o.mouseIsPressed=!0,o.mouseButton=e.LEFT,e.mousePressed(d)),e.touchStarted(d)},e._ontouchmove=d=>{o.touches=[...d.touches].map(s),e._isTouchAware||(o.mouseX=e.touches[0].x,o.mouseY=e.touches[0].y,e.mouseDragged(d)||d.preventDefault()),e.touchMoved(d)||d.preventDefault()},e._ontouchend=d=>{o.touches=[...d.touches].map(s),!e._isTouchAware&&!e.touches.length&&(o.mouseIsPressed=!1,e.mouseReleased(d)||d.preventDefault()),e.touchEnded(d)||d.preventDefault()},t){let d=t.addEventListener.bind(t);d("mousedown",c=>e._onmousedown(c)),d("wheel",c=>e._onwheel(c)),d("click",c=>e._onclick(c)),d("touchstart",c=>e._ontouchstart(c)),d("touchmove",c=>e._ontouchmove(c)),d("touchend",c=>e._ontouchend(c)),d("touchcancel",c=>e._ontouchend(c))}if(window){let d=window.addEventListener;d("keydown",c=>e._onkeydown(c),!1),d("keyup",c=>e._onkeyup(c),!1),t||(d("mousedown",c=>e._onmousedown(c)),d("wheel",c=>e._onwheel(c)),d("click",c=>e._onclick(c))),d("mousemove",c=>e._onmousemove(c),!1),d("mouseup",c=>{a>0&&(a--,e._onmouseup(c))})}},n.modules.math=(e,o)=>{e.RADIANS=0,e.DEGREES=1,e.PI=Math.PI,e.HALF_PI=Math.PI/2,e.QUARTER_PI=Math.PI/4,e.TWO_PI=e.TAU=Math.PI*2,e.abs=Math.abs,e.ceil=Math.ceil,e.exp=Math.exp,e.floor=e.int=Math.floor,e.loge=Math.log,e.mag=Math.hypot,e.max=Math.max,e.min=Math.min,e.round=Math.round,e.pow=Math.pow,e.sqrt=Math.sqrt,e.SHR3=1,e.LCG=2;let i=e._angleMode=0;e.angleMode=l=>(i=e._angleMode=l==0||l=="radians"?0:1,i?"degrees":"radians");let r=e._DEGTORAD=Math.PI/180,t=e._RADTODEG=180/Math.PI;e.degrees=l=>l*e._RADTODEG,e.radians=l=>l*e._DEGTORAD,e.map=n.prototype.map=(l,f,g,_,y,w)=>{let m=_+(y-_)*((l-f)*1/(g-f));return w?_<y?Math.min(Math.max(m,_),y):Math.min(Math.max(m,y),_):m},e.dist=function(){let l=arguments;return l.length==2?Math.hypot(l[0].x-l[1].x,l[0].y-l[1].y):l.length==4?Math.hypot(l[0]-l[2],l[1]-l[3]):Math.hypot(l[0]-l[3],l[1]-l[4],l[2]-l[5])},e.lerp=(l,f,g)=>l*(1-g)+f*g,e.constrain=(l,f,g)=>Math.min(Math.max(l,f),g),e.norm=(l,f,g)=>e.map(l,f,g,0,1),e.sq=l=>l*l,e.fract=l=>l-Math.floor(l),e.sin=l=>Math.sin(i?l*r:l),e.cos=l=>Math.cos(i?l*r:l),e.tan=l=>Math.tan(i?l*r:l),e.asin=l=>{let f=Math.asin(l);return i?f*t:f},e.acos=l=>{let f=Math.acos(l);return i?f*t:f},e.atan=l=>{let f=Math.atan(l);return i?f*t:f},e.atan2=(l,f)=>{let g=Math.atan2(l,f);return i?g*t:g};function a(){let _,y;return{setSeed(w){y=_=(w??Math.random()*4294967296)>>>0},getSeed(){return _},rand(){return y=(1664525*y+1013904223)%4294967296,y/4294967296}}}function s(){let l,f,g=4294967295;return{setSeed(_){l=f=(_??Math.random()*g)>>>0},getSeed(){return f},rand(){return l^=l<<17,l^=l>>13,l^=l<<5,(l>>>0)/g}}}let d=s();d.setSeed(),e.randomSeed=l=>d.setSeed(l),e.random=(l,f)=>l===void 0?d.rand():typeof l=="number"?f!==void 0?d.rand()*(f-l)+l:d.rand()*l:l[Math.trunc(l.length*d.rand())],e.randomGenerator=l=>{l==e.LCG?d=a():l==e.SHR3&&(d=s()),d.setSeed()};var c=new function(){var l,f,g=new Array(128),_=new Array(256),y,w=new Array(128),m=new Array(128),b=new Array(256),S=new Array(256),x=()=>d.rand()*4294967296-2147483648,v=()=>.5+(x()<<0)*2328306e-16,E=()=>(y=x(),l=y&127,Math.abs(y)<g[l]?y*w[l]:u()),P=()=>(f=x()>>>0,l=f&255,f<g[l]?f*b[l]:h()),u=()=>{for(var C=3.44262,I,k,R,A;;){if(I=y*w[l],l==0){do R=v(),A=v(),I=-Math.log(R)*.2904764,k=-Math.log(A);while(k+k<I*I);return y>0?C+I:-3.44262-I}if(m[l]+v()*(m[l-1]-m[l])<Math.exp(-.5*I*I))return I;if(y=x(),l=y&127,Math.abs(y)<g[l])return y*w[l]}},h=()=>{for(var C;;){if(l==0)return 7.69711-Math.log(v());if(C=f*b[l],S[l]+v()*(S[l-1]-S[l])<Math.exp(-C))return C;if(f=x(),l=f&255,f<_[l])return f*b[l]}},M=()=>{var C=2147483648,I=4294967296,k=3.442619855899,R=k,A=.00991256303526217,T,O=7.697117470131487,F=O,L=.003949659822581572,D;for(T=A/Math.exp(-.5*k*k),g[0]=Math.floor(k/T*C),g[1]=0,w[0]=T/C,w[127]=k/C,m[0]=1,m[127]=Math.exp(-.5*k*k),D=126;D>=1;D--)k=Math.sqrt(-2*Math.log(A/k+Math.exp(-.5*k*k))),g[D+1]=Math.floor(k/R*C),R=k,m[D]=Math.exp(-.5*k*k),w[D]=k/C;for(T=L/Math.exp(-O),_[0]=Math.floor(O/T*I),_[1]=0,b[0]=T/I,b[255]=O/I,S[0]=1,S[255]=Math.exp(-O),D=254;D>=1;D--)O=-Math.log(L/O+Math.exp(-O)),_[D+1]=Math.floor(O/F*I),F=O,S[D]=Math.exp(-O),b[D]=O/I};this.SHR3=x,this.UNI=v,this.RNOR=E,this.REXP=P,this.zigset=M};c.hasInit=!1,e.randomGaussian=(l,f)=>(c.hasInit||(c.zigset(),c.hasInit=!0),c.RNOR()*f+l),e.randomExponential=()=>(c.hasInit||(c.zigset(),c.hasInit=!0),c.REXP()),e.PERLIN="perlin",e.SIMPLEX="simplex",e.BLOCKY="blocky",e.Noise=n.PerlinNoise;let p;e.noiseMode=l=>{o.Noise=n[l[0].toUpperCase()+l.slice(1)+"Noise"],p=null},e.noiseSeed=l=>{p=new e.Noise(l)},e.noise=(l=0,f=0,g=0)=>(p??=new e.Noise,p.noise(l,f,g)),e.noiseDetail=(l,f)=>{p??=new e.Noise,l>0&&(p.octaves=l),f>0&&(p.falloff=f)}},n.Noise=class{},n.PerlinNoise=class extends n.Noise{constructor(e){super(),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.octaves=1,this.falloff=.5,e==null?this.p=Array.from({length:256},()=>Math.floor(Math.random()*256)):this.p=this.seedPermutation(e),this.p=this.p.concat(this.p)}seedPermutation(e){let o=[];for(let t=0;t<256;t++)o[t]=t;let i,r;for(let t=255;t>0;t--)e=e*16807%2147483647,i=e%(t+1),r=o[t],o[t]=o[i],o[i]=r;return o}dot(e,o,i,r){return e[0]*o+e[1]*i+e[2]*r}mix(e,o,i){return(1-i)*e+i*o}fade(e){return e*e*e*(e*(e*6-15)+10)}noise(e,o,i){let r=this,t=0,a=1,s=1,d=0;for(let c=0;c<r.octaves;c++){const p=Math.floor(e*a)&255,l=Math.floor(o*a)&255,f=Math.floor(i*a)&255,g=e*a-Math.floor(e*a),_=o*a-Math.floor(o*a),y=i*a-Math.floor(i*a),w=r.fade(g),m=r.fade(_),b=r.fade(y),S=r.p[p]+l,x=r.p[S]+f,v=r.p[S+1]+f,E=r.p[p+1]+l,P=r.p[E]+f,u=r.p[E+1]+f,h=r.mix(r.dot(r.grad3[r.p[x]%12],g,_,y),r.dot(r.grad3[r.p[P]%12],g-1,_,y),w),M=r.mix(r.dot(r.grad3[r.p[v]%12],g,_-1,y),r.dot(r.grad3[r.p[u]%12],g-1,_-1,y),w),C=r.mix(r.dot(r.grad3[r.p[x+1]%12],g,_,y-1),r.dot(r.grad3[r.p[P+1]%12],g-1,_,y-1),w),I=r.mix(r.dot(r.grad3[r.p[v+1]%12],g,_-1,y-1),r.dot(r.grad3[r.p[u+1]%12],g-1,_-1,y-1),w),k=r.mix(h,M,m),R=r.mix(C,I,m);t+=r.mix(k,R,b)*s,d+=s,s*=r.falloff,a*=2}return(t/d+1)/2}},n.modules.sound=(e,o)=>{e.Sound=n.Sound;let i=[];e.loadSound=(r,t)=>{o._preloadCount++;let a=new n.Sound;return i.push(a),a._loader=(async()=>{let s;try{await a.load(r)}catch(d){s=d}if(o._preloadCount--,delete a._loader,s)throw s;return t&&t(a),a})(),e._disablePreload?a._loader:a},e.loadAudio=(r,t)=>{o._preloadCount++;let a=new Audio(r);a.crossOrigin="Anonymous",a.addEventListener("canplaythrough",()=>{a.loaded||(o._preloadCount--,a.loaded=!0,t&&t(a))});let s=()=>{a._preloadSkip=!0,o._preloadCount--};return a.addEventListener("suspend",s),a.addEventListener("error",d=>{throw s(),d}),a},e.getAudioContext=()=>n.aud,e.userStartAudio=()=>{if(window.AudioContext){if(n._offlineAudio){n._offlineAudio=!1,n.aud=new window.AudioContext;for(let r of i)r.init()}return n.aud.resume()}}},window.OfflineAudioContext&&(n.aud=new window.OfflineAudioContext(2,1,44100),n._offlineAudio=!0),n.Sound=class{constructor(){this.sources=new Set,this.loaded=this.paused=!1}async load(e){this.url=e;let o=await fetch(e);this.buffer=await o.arrayBuffer(),this.buffer=await n.aud.decodeAudioData(this.buffer)}init(){this.gainNode=n.aud.createGain(),this.pannerNode=n.aud.createStereoPanner(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(n.aud.destination),this.loaded=!0,this._volume&&(this.volume=this._volume),this._pan&&(this.pan=this._pan)}_newSource(e,o){let i=n.aud.createBufferSource();i.buffer=this.buffer,i.connect(this.gainNode),i.loop=this._loop,i._startedAt=n.aud.currentTime,i._offset=e,i._duration=o,i.start(0,i._offset,i._duration),this.sources.add(i),i.onended=()=>{this.paused||(this.ended=!0,this.sources.delete(i))}}play(e=0,o){if(this.loaded){if(!this.paused)this._newSource(e,o);else{let i=[];for(let r of this.sources)i.push(r._offset,r._duration),this.sources.delete(r);for(let r=0;r<i.length;r+=2)this._newSource(i[r],i[r+1])}this.paused=this.ended=!1}}pause(){if(this.isPlaying()){for(let e of this.sources){e.stop();let o=n.aud.currentTime-e._startedAt;e._offset+=o,e._duration&&(e._duration-=o)}this.paused=!0}}stop(){for(let e of this.sources)e.stop(),this.sources.delete(e);this.paused=!1,this.ended=!0}get volume(){return this._volume}set volume(e){this.loaded&&(this.gainNode.gain.value=e),this._volume=e}get pan(){return this._pan}set pan(e){this.loaded&&(this.pannerNode.pan.value=e),this._pan=e}get loop(){return this._loop}set loop(e){this.sources.forEach(o=>o.loop=e),this._loop=e}get playing(){return!this.paused&&this.sources.size>0}setVolume(e){this.volume=e}setPan(e){this.pan=e}setLoop(e){this.loop=e}isLoaded(){return this.loaded}isPlaying(){return this.playing}isPaused(){return this.paused}isLooping(){return this._loop}},n.modules.util=(e,o)=>{e._loadFile=(i,r,t)=>{o._preloadCount++;let a={};return a._loader=new Promise((s,d)=>{fetch(i).then(c=>c.ok?t=="json"?c.json():c.text():(d("error loading file"),null)).then(c=>{t=="csv"&&(c=e.CSV.parse(c)),typeof c=="string"?a.text=c:Object.assign(a,c),delete a._loader,r&&r(c),o._preloadCount--,s(c)})}),a},e.loadText=(i,r)=>e._loadFile(i,r,"text"),e.loadJSON=(i,r)=>e._loadFile(i,r,"json"),e.loadCSV=(i,r)=>e._loadFile(i,r,"csv"),e.load=function(...i){Array.isArray(i[0])&&(i=i[0]);let r=[];for(let t of i){let a=t.split(".").pop().toLowerCase(),s;a=="json"&&!t.includes("-msdf.")?s=e.loadJSON(t):a=="csv"?s=e.loadCSV(t):/(jpe?g|png|gif|webp|avif|svg)/.test(a)?s=e.loadImage(t):/(ttf|otf|woff2?|eot|json)/i.test(a)?s=e.loadFont(t):/(wav|flac|mp3|ogg|m4a|aac|aiff|weba)/.test(a)?s=e.loadSound(t):s=e.loadText(t),r.push(s._loader)}return i.length==1?r[0]:Promise.all(r)},e.CSV={},e.CSV.parse=(i,r=",",t=`
`)=>{if(!i.length)return[];let a=[],s=i.split(t),d=s[0].split(r).map(c=>c.replaceAll('"',""));for(let c=1;c<s.length;c++){let p={},l=s[c].split(r);d.forEach((f,g)=>p[f]=JSON.parse(l[g])),a.push(p)}return a},typeof localStorage=="object"&&(e.storeItem=localStorage.setItem,e.getItem=localStorage.getItem,e.removeItem=localStorage.removeItem,e.clearStorage=localStorage.clear),e.year=()=>new Date().getFullYear(),e.day=()=>new Date().getDay(),e.hour=()=>new Date().getHours(),e.minute=()=>new Date().getMinutes(),e.second=()=>new Date().getSeconds()},n.modules.vector=e=>{e.createVector=(o,i,r)=>new n.Vector(o,i,r,e)},n.Vector=class{constructor(e,o,i,r){this.x=e||0,this.y=o||0,this.z=i||0,this._$=r||window,this._cn=null,this._cnsq=null}set(e,o,i){return this.x=e?.x||e||0,this.y=e?.y||o||0,this.z=e?.z||i||0,this}copy(){return new n.Vector(this.x,this.y,this.z)}_arg2v(e,o,i){return e?.x!==void 0?e:o!==void 0?{x:e,y:o,z:i||0}:{x:e,y:e,z:e}}_calcNorm(){this._cnsq=this.x*this.x+this.y*this.y+this.z*this.z,this._cn=Math.sqrt(this._cnsq)}add(){let e=this._arg2v(...arguments);return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}rem(){let e=this._arg2v(...arguments);return this.x%=e.x,this.y%=e.y,this.z%=e.z,this}sub(){let e=this._arg2v(...arguments);return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}mult(){let e=this._arg2v(...arguments);return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}div(){let e=this._arg2v(...arguments);return e.x?this.x/=e.x:this.x=0,e.y?this.y/=e.y:this.y=0,e.z?this.z/=e.z:this.z=0,this}mag(){return this._calcNorm(),this._cn}magSq(){return this._calcNorm(),this._cnsq}dot(){let e=this._arg2v(...arguments);return this.x*e.x+this.y*e.y+this.z*e.z}dist(){let e=this._arg2v(...arguments),o=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return Math.sqrt(o*o+i*i+r*r)}cross(){let e=this._arg2v(...arguments),o=this.y*e.z-this.z*e.y,i=this.z*e.x-this.x*e.z,r=this.x*e.y-this.y*e.x;return this.x=o,this.y=i,this.z=r,this}normalize(){this._calcNorm();let e=this._cn;return e!=0&&(this.x/=e,this.y/=e,this.z/=e),this._cn=1,this._cnsq=1,this}limit(e){this._calcNorm();let o=this._cn;if(o>e){let i=e/o;this.x*=i,this.y*=i,this.z*=i,this._cn=e,this._cnsq=e*e}return this}setMag(e){this._calcNorm();let o=this._cn,i=e/o;return this.x*=i,this.y*=i,this.z*=i,this._cn=e,this._cnsq=e*e,this}heading(){return this._$.atan2(this.y,this.x)}setHeading(e){let o=this.mag();return this.x=o*this._$.cos(e),this.y=o*this._$.sin(e),this}rotate(e){let o=this._$.cos(e),i=this._$.sin(e),r=this.x*o-this.y*i,t=this.x*i+this.y*o;return this.x=r,this.y=t,this}angleBetween(){let e=this._arg2v(...arguments),o=n.Vector.cross(this,e);return this._$.atan2(o.mag(),this.dot(e))*Math.sign(o.z||1)}lerp(){let e=[...arguments],o=e.at(-1);if(o==0)return this;let i=this._arg2v(...e.slice(0,-1));return this.x+=(i.x-this.x)*o,this.y+=(i.y-this.y)*o,this.z+=(i.z-this.z)*o,this}slerp(){let e=[...arguments],o=e.at(-1);if(o==0)return this;let i=this._arg2v(...e.slice(0,-1));if(o==1)return this.set(i);let r=this.mag(),t=i.mag();if(r==0||t==0)return this.mult(1-o).add(i.mult(o));let a=n.Vector.cross(this,i),s=a.mag(),d=Math.atan2(s,this.dot(i));if(s>0)a.div(s);else{if(d<this._$.HALF_PI)return this.mult(1-o).add(i.mult(o));this.z==0&&i.z==0?a.set(0,0,1):this.x!=0?a.set(this.y,-this.x,0).normalize():a.set(1,0,0)}let c=a.cross(this),p=1-o+o*t/r,l=p*Math.cos(o*d),f=p*Math.sin(o*d);return this.x=this.x*l+c.x*f,this.y=this.y*l+c.y*f,this.z=this.z*l+c.z*f,this}reflect(e){return e.normalize(),this.sub(e.mult(2*this.dot(e)))}array(){return[this.x,this.y,this.z]}equals(e,o){return o??=Number.EPSILON||0,Math.abs(e.x-this.x)<o&&Math.abs(e.y-this.y)<o&&Math.abs(e.z-this.z)<o}fromAngle(e,o){return o===void 0&&(o=1),this._cn=o,this._cnsq=o*o,this.x=o*this._$.cos(e),this.y=o*this._$.sin(e),this.z=0,this}fromAngles(e,o,i){i===void 0&&(i=1),this._cn=i,this._cnsq=i*i;const r=this._$.cos(o),t=this._$.sin(o),a=this._$.cos(e),s=this._$.sin(e);return this.x=i*s*t,this.y=-i*a,this.z=i*s*r,this}random2D(){return this._cn=this._cnsq=1,this.fromAngle(Math.random()*Math.PI*2)}random3D(){return this._cn=this._cnsq=1,this.fromAngles(Math.random()*Math.PI*2,Math.random()*Math.PI*2)}toString(){return`[${this.x}, ${this.y}, ${this.z}]`}},n.Vector.add=(e,o)=>e.copy().add(o),n.Vector.cross=(e,o)=>e.copy().cross(o),n.Vector.dist=(e,o)=>Math.hypot(e.x-o.x,e.y-o.y,e.z-o.z),n.Vector.div=(e,o)=>e.copy().div(o),n.Vector.dot=(e,o)=>e.copy().dot(o),n.Vector.equals=(e,o,i)=>e.equals(o,i),n.Vector.lerp=(e,o,i)=>e.copy().lerp(o,i),n.Vector.slerp=(e,o,i)=>e.copy().slerp(o,i),n.Vector.limit=(e,o)=>e.copy().limit(o),n.Vector.heading=e=>this._$.atan2(e.y,e.x),n.Vector.magSq=e=>e.x*e.x+e.y*e.y+e.z*e.z,n.Vector.mag=e=>Math.sqrt(n.Vector.magSq(e)),n.Vector.mult=(e,o)=>e.copy().mult(o),n.Vector.normalize=e=>e.copy().normalize(),n.Vector.rem=(e,o)=>e.copy().rem(o),n.Vector.sub=(e,o)=>e.copy().sub(o);for(let e of["fromAngle","fromAngles","random2D","random3D"])n.Vector[e]=(o,i,r)=>new n.Vector()[e](o,i,r);return n.renderers.webgpu={},n.renderers.webgpu.canvas=(e,o)=>{let i=e.canvas;i.width=e.width=500,i.height=e.height=500,e._g=e.createGraphics(1,1),e.colorMode&&e.colorMode("rgb",1);let r,t,a=1,s=8;e._pipelineConfigs=[],e._pipelines=[];let d=e.drawStack=[],c=e.colorStack=new Float32Array(1e6);c.set([0,0,0,1,1,1,1,1]);let p=n.device.createBindGroupLayout({label:"mainLayout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]});e.bindGroupLayouts=[p];let l=n.device.createBuffer({size:8,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),f=()=>{t=n.device.createTexture({size:[e.canvas.width,e.canvas.height],sampleCount:4,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT}).createView()};e._createCanvas=(u,h,M)=>(o.ctx=o.drawingContext=i.getContext("webgpu"),M.format??=navigator.gpu.getPreferredCanvasFormat(),M.device??=n.device,M.alpha&&(M.alphaMode="premultiplied"),e.ctx.configure(M),n.device.queue.writeBuffer(l,0,new Float32Array([e.canvas.hw,e.canvas.hh])),f(),i),e._resizeCanvas=(u,h)=>{e._setCanvasSize(u,h),f()},e.pixelDensity=u=>!u||u==e._pixelDensity?e._pixelDensity:(e._pixelDensity=u,e._setCanvasSize(i.w,i.h),f(),u);let g=(u,h,M,C=1)=>{typeof u=="string"?u=e.color(u):M==null&&(C=h??1,h=M=u),u._q5Color&&(C=u.a,M=u.b,h=u.g,u=u.r);let I=c,k=s;I[k++]=u,I[k++]=h,I[k++]=M,I[k++]=C,s=k,a++};e._stroke=0,e._fill=e._tint=e._globalAlpha=1,e._doFill=e._doStroke=!0,e.fill=(u,h,M,C)=>{g(u,h,M,C),e._doFill=e._fillSet=!0,e._fill=a},e.stroke=(u,h,M,C)=>{g(u,h,M,C),e._doStroke=e._strokeSet=!0,e._stroke=a},e.tint=(u,h,M,C)=>{g(u,h,M,C),e._tint=a},e.opacity=u=>e._globalAlpha=u,e.noFill=()=>e._doFill=!1,e.noStroke=()=>e._doStroke=!1,e.noTint=()=>e._tint=1,e._strokeWeight=1,e._hsw=.5,e._scaledSW=1,e.strokeWeight=u=>{u=Math.abs(u),e._strokeWeight=u,e._scaledSW=u*e._scale,e._hsw=u/2};const _=1e7,y=16,w=new Float32Array(_*y);let m,b=[],S=[];e._matrixDirty=!1,b.push([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),w.set(b[0]),e.resetMatrix=()=>{m=b[0].slice(),e._matrixIndex=0},e.resetMatrix(),e.translate=(u,h,M)=>{!u&&!h&&!M||(m[12]+=u,m[13]-=h,m[14]+=M||0,e._matrixDirty=!0)},e.rotate=u=>{if(!u)return;e._angleMode&&(u*=e._DEGTORAD);let h=Math.cos(u),M=Math.sin(u),C=m,I=C[0],k=C[1],R=C[4],A=C[5];I==1&&!k&&!R&&A==1?(C[0]=h,C[1]=-M,C[4]=M,C[5]=h):(C[0]=I*h+k*M,C[1]=k*h-I*M,C[4]=R*h+A*M,C[5]=A*h-R*M),e._matrixDirty=!0},e._scale=1,e.scale=(u=1,h,M=1)=>{h??=u,e._scale=Math.max(Math.abs(u),Math.abs(h)),e._scaledSW=e._strokeWeight*e._scale;let C=m;C[0]*=u,C[1]*=u,C[2]*=u,C[3]*=u,C[4]*=h,C[5]*=h,C[6]*=h,C[7]*=h,C[8]*=M,C[9]*=M,C[10]*=M,C[11]*=M,e._matrixDirty=!0},e.shearX=u=>{if(!u)return;e._angleMode&&(u*=e._DEGTORAD);let h=Math.tan(u),M=m,C=M[0],I=M[1],k=M[4],R=M[5];M[0]=C+k*h,M[1]=I+R*h,e._matrixDirty=!0},e.shearY=u=>{if(!u)return;e._angleMode&&(u*=e._DEGTORAD);let h=Math.tan(u),M=m,C=M[0],I=M[1],k=M[4],R=M[5];M[4]=k+C*h,M[5]=R+I*h,e._matrixDirty=!0},e.applyMatrix=(...u)=>{let h;if(u.length==1?h=u[0]:h=u,h.length==9)h=[h[0],h[1],0,h[2],h[3],h[4],0,h[5],0,0,1,0,h[6],h[7],0,h[8]];else if(h.length!=16)throw new Error("Matrix must be a 3x3 or 4x4 array.");m=h.slice(),e._matrixDirty=!0},e._saveMatrix=()=>{w.set(m,b.length*y),e._matrixIndex=b.length,b.push(m.slice()),e._matrixDirty=!1},e.pushMatrix=()=>{e._matrixDirty&&e._saveMatrix(),S.push(e._matrixIndex)},e.popMatrix=()=>{if(!S.length)return console.warn("Matrix index stack is empty!");let u=S.pop();m=b[u].slice(),e._matrixIndex=u,e._matrixDirty=!1};let x=e.pushStyles;e.pushStyles=()=>{x(),e.strokeWeight(e._strokeWeight)},e.push=()=>{e.pushMatrix(),e.pushStyles()},e.pop=()=>{e.popMatrix(),e.popStyles()},e._calcBox=(u,h,M,C,I)=>{let k=M/2,R=C/2,A,T,O,F;return!I||I=="corner"?(A=u,T=u+M,O=-h,F=-(h+C)):I=="center"?(A=u-k,T=u+k,O=-(h-R),F=-(h+R)):(A=u,T=M,O=-h,F=-C),[A,T,O,F]};let v=["zero","one","src-alpha","one-minus-src-alpha","dst","dst-alpha","one-minus-dst-alpha","one-minus-src"],E=["add","subtract","reverse-subtract","min","max"];const P={normal:[2,3,0,2,3,0],additive:[1,1,0,1,1,0]};e.blendConfigs={};for(const[u,h]of Object.entries(P))e.blendConfigs[u]={color:{srcFactor:v[h[0]],dstFactor:v[h[1]],operation:E[h[2]]},alpha:{srcFactor:v[h[3]],dstFactor:v[h[4]],operation:E[h[5]]}};e._blendMode="normal",e.blendMode=u=>{if(u!=e._blendMode){u=="source-over"&&(u="normal"),u=="lighter"&&(u="additive"),u=u.toLowerCase().replace(/[ -]/g,"_"),e._blendMode=u;for(let h=0;h<e._pipelines.length;h++)e._pipelineConfigs[h].fragment.targets[0].blend=e.blendConfigs[u],e._pipelines[h]=n.device.createRenderPipeline(e._pipelineConfigs[h])}},e.clear=()=>{},e._beginRender=()=>{e.encoder=n.device.createCommandEncoder(),r=o.pass=e.encoder.beginRenderPass({label:"q5-webgpu",colorAttachments:[{view:t,resolveTarget:e.ctx.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:[0,0,0,0]}]})},e._render=()=>{let u=n.device.createBuffer({size:b.length*y*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(u.getMappedRange()).set(w.slice(0,b.length*y)),u.unmap();let h=n.device.createBuffer({size:s*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(h.getMappedRange()).set(c.slice(0,s)),h.unmap();let M=n.device.createBindGroup({layout:p,entries:[{binding:0,resource:{buffer:l}},{binding:1,resource:{buffer:u}},{binding:2,resource:{buffer:h}}]});r.setBindGroup(0,M);for(let A of e._hooks.preRender)A();let C=0,I=0,k=0,R=-1;for(let A=0;A<d.length;A+=2){let T=d[A+1];if(R!=d[A]&&(R=d[A],r.setPipeline(e._pipelines[R])),R==0)r.draw(T,1,C),C+=T;else if(R==1)r.setBindGroup(1,e._textureBindGroups[T]),r.draw(4,1,I),I+=4;else if(R==2){let O=d[A+2];r.setBindGroup(1,e._fonts[O].bindGroup),r.setBindGroup(2,e._textBindGroup),r.draw(4,T,0,k),k+=T,A++}}},e._finishRender=()=>{r.end();let u=e.encoder.finish();n.device.queue.submit([u]),o.pass=e.encoder=null,e.drawStack=d=[],a=1,s=8,b=[b[0]],S=[];for(let h of e._hooks.postRender)h()}},n.initWebGPU=async()=>{if(!navigator.gpu)return console.warn("q5 WebGPU not supported on this browser! Use Google Chrome or Edge."),!1;if(!n.device){let e=await navigator.gpu.requestAdapter();if(!e)return console.warn("q5 WebGPU could not start! No appropriate GPUAdapter found, vulkan may need to be enabled."),!1;n.device=await e.requestDevice()}return!0},n.webgpu=async function(e,o){return(!e||e=="global")&&(n._hasGlobal=!0),await n.initWebGPU()?new n(e,o,"webgpu"):new n(e,o,"webgpu-fallback")},n.renderers.webgpu.drawing=(e,o)=>{let i=e.canvas,r=e.drawStack,t=new Float32Array(1e7),a=0;const s=Math.PI*2,d=Math.PI/2;let c=n.device.createShaderModule({label:"drawingShader",code:`
struct Uniforms {
	halfWidth: f32,
	halfHeight: f32
}
struct VertexParams {
	@location(0) pos: vec2f,
	@location(1) colorIndex: f32,
	@location(2) matrixIndex: f32
}
struct FragmentParams {
	@builtin(position) position: vec4f,
	@location(0) color: vec4f
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;
@group(0) @binding(1) var<storage> transforms: array<mat4x4<f32>>;
@group(0) @binding(2) var<storage> colors : array<vec4f>;

@vertex
fn vertexMain(v: VertexParams) -> FragmentParams {
	var vert = vec4f(v.pos, 0.0, 1.0);
	vert = transforms[i32(v.matrixIndex)] * vert;
	vert.x /= uniforms.halfWidth;
	vert.y /= uniforms.halfHeight;

	var f: FragmentParams;
	f.position = vert;
	f.color = colors[i32(v.colorIndex)];
	return f;
}

@fragment
fn fragmentMain(@location(0) color: vec4f) -> @location(0) vec4f {
	return color;
}
`}),p={arrayStride:16,attributes:[{format:"float32x2",offset:0,shaderLocation:0},{format:"float32",offset:8,shaderLocation:1},{format:"float32",offset:12,shaderLocation:2}]},l=n.device.createPipelineLayout({label:"drawingPipelineLayout",bindGroupLayouts:e.bindGroupLayouts});e._pipelineConfigs[0]={label:"drawingPipeline",layout:l,vertex:{module:c,entryPoint:"vertexMain",buffers:[p]},fragment:{module:c,entryPoint:"fragmentMain",targets:[{format:"bgra8unorm",blend:e.blendConfigs.normal}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"},multisample:{count:4}},e._pipelines[0]=n.device.createRenderPipeline(e._pipelineConfigs[0]);const f=(x,v,E,P)=>{let u=t,h=a;u[h++]=x,u[h++]=v,u[h++]=E,u[h++]=P,a=h},g=(x,v,E,P,u,h,M,C,I,k)=>{let R=t,A=a;R[A++]=x,R[A++]=v,R[A++]=I,R[A++]=k,R[A++]=E,R[A++]=P,R[A++]=I,R[A++]=k,R[A++]=M,R[A++]=C,R[A++]=I,R[A++]=k,R[A++]=u,R[A++]=h,R[A++]=I,R[A++]=k,a=A,r.push(0,4)},_=(x,v,E,P,u,h,M,C,I)=>{let R=(h-u)/M,A=u,T=t,O=a;for(let F=0;F<=M;F++){T[O++]=x,T[O++]=v,T[O++]=C,T[O++]=I;let L=x+E*Math.cos(A),D=v+P*Math.sin(A);T[O++]=L,T[O++]=D,T[O++]=C,T[O++]=I,A+=R}a=O,r.push(0,(M+1)*2)},y=(x,v,E,P,u,h,M,C,I,k,R)=>{let T=(C-M)/I,O=M,F=t,L=a;for(let D=0;D<=I;D++){let B=x+E*Math.cos(O),U=v+P*Math.sin(O),z=x+u*Math.cos(O),G=v+h*Math.sin(O);F[L++]=B,F[L++]=U,F[L++]=k,F[L++]=R,F[L++]=z,F[L++]=G,F[L++]=k,F[L++]=R,O+=T}a=L,r.push(0,(I+1)*2)};e.rectMode=x=>e._rectMode=x,e.rect=(x,v,E,P,u=0)=>{let[h,M,C,I]=e._calcBox(x,v,E,P,e._rectMode),k,R;if(e._matrixDirty&&e._saveMatrix(),R=e._matrixIndex,!u){if(e._doFill&&(k=e._fill,g(h,C,M,C,M,I,h,I,k,R)),e._doStroke){k=e._stroke;let D=e._strokeWeight/2,B=h-D,U=M+D,z=C+D,G=I-D,W=h+D,H=M-D,V=C-D,j=I+D;g(B,V,U,V,U,z,B,z,k,R),g(B,G,U,G,U,j,B,j,k,R),z=C-D,G=I+D,g(B,z,W,z,W,G,B,G,k,R),g(H,z,U,z,U,G,H,G,k,R)}return}h+=u,M-=u,C-=u,I+=u,u=Math.min(u,Math.min(E,P)/2);let A=w(u*e._scale),T=C+u,O=I-u,F=h-u,L=M+u;if(e._doFill&&(k=e._fill,_(M,I,u,u,-d,0,A,k,R),_(h,I,u,u,-Math.PI,-d,A,k,R),_(h,C,u,u,Math.PI,d,A,k,R),_(M,C,u,u,0,d,A,k,R),g(h,T,M,T,M,O,h,O,k,R),g(h,C,F,C,F,I,h,I,k,R),g(L,C,M,C,M,I,L,I,k,R)),e._doStroke){k=e._stroke;let D=e._hsw,B=u+D,U=u+D,z=u-D,G=u-D;y(M,I,B,U,z,G,-d,0,A,k,R),y(h,I,B,U,z,G,-Math.PI,-d,A,k,R),y(h,C,B,U,z,G,Math.PI,d,A,k,R),y(M,C,B,U,z,G,0,d,A,k,R);let W=F-D,H=F+D,V=L-D,j=L+D,q=T-D,Q=T+D,J=O-D,K=O+D;g(W,C,H,C,H,I,W,I,k,R),g(V,C,j,C,j,I,V,I,k,R),g(h,q,M,q,M,Q,h,Q,k,R),g(h,J,M,J,M,K,h,K,k,R)}},e.square=(x,v,E)=>e.rect(x,v,E,E);const w=x=>x<4?6:x<6?8:x<10?10:x<16?12:x<20?14:x<22?16:x<24?18:x<28?20:x<34?22:x<42?24:x<48?26:x<56?28:x<64?30:x<72?32:x<84?34:x<96?36:x<98?38:x<113?40:x<149?44:x<199?48:x<261?52:x<353?56:x<461?60:x<585?64:x<1200?70:x<1800?80:x<2400?90:100;e._ellipseMode=n.CENTER,e.ellipseMode=x=>e._ellipseMode=x,e.ellipse=(x,v,E,P)=>{let u=w(Math.max(Math.abs(E),Math.abs(P))*e._scale),h=E/2,M=E==P?h:P/2;e._matrixDirty&&e._saveMatrix();let C=e._matrixIndex;if(e._doFill&&_(x,-v,h,M,0,s,u,e._fill,C),e._doStroke){let I=e._strokeWeight/2;y(x,-v,h+I,M+I,h-I,M-I,0,s,u,e._stroke,C)}},e.circle=(x,v,E)=>e.ellipse(x,v,E,E),e.arc=(x,v,E,P,u,h)=>{if(u===h||(e._angleMode&&(u=e.radians(u),h=e.radians(h)),u%=s,h%=s,u<0&&(u+=s),h<0&&(h+=s),u>h&&(h+=s),u==h))return e.ellipse(x,v,E,P);let M,C;e._ellipseMode==e.CENTER?(M=E/2,C=P/2):e._ellipseMode==e.RADIUS?(M=E,C=P):e._ellipseMode==e.CORNER?(x+=E/2,v+=P/2,M=E/2,C=P/2):e._ellipseMode==e.CORNERS&&(x=(x+E)/2,v=(v+P)/2,M=(E-x)/2,C=(P-v)/2);let I=e._matrixIndex;e._matrixDirty&&e._saveMatrix();let k=w(Math.max(Math.abs(E),Math.abs(P))*e._scale);if(e._doFill&&_(x,-v,M,C,u,h,k,e._fill,I),e._doStroke){let R=e._strokeWeight;y(x,-v,M+R,C+R,M-R,C-R,u,h,k,e._stroke,I)}},e.point=(x,v)=>{e._matrixDirty&&e._saveMatrix();let E=e._matrixIndex,P=e._stroke,u=e._strokeWeight;if(e._scaledSW<2){let[h,M,C,I]=e._calcBox(x,v,u,u,"corner");g(h,C,M,C,M,I,h,I,P,E)}else{let h=w(e._scaledSW);u/=2,_(x,-v,u,u,0,s,h,P,E)}},e._strokeJoin="round",e.strokeJoin=x=>{e._strokeJoin=x},e.line=(x,v,E,P)=>{e._matrixDirty&&e._saveMatrix();let u=e._matrixIndex,h=e._stroke;e._strokeWeight;let M=e._hsw,C=E-x,I=P-v,k=Math.hypot(C,I),R=-(I/k)*M,A=C/k*M;if(g(x+R,-v-A,x-R,-v+A,E-R,-P+A,E+R,-P-A,h,u),e._scaledSW>2&&e._strokeJoin!="none"){let T=w(e._scaledSW);_(x,-v,M,M,0,s,T,h,u),_(E,-P,M,M,0,s,T,h,u)}};let m,b=[],S=[];e.beginShape=()=>{m=0,b=[],S=[]},e.vertex=(x,v)=>{e._matrixDirty&&e._saveMatrix(),b.push(x,-v,e._fill,e._matrixIndex),m++},e.curveVertex=(x,v)=>{e._matrixDirty&&e._saveMatrix(),S.push({x,y:-v})},e.endShape=x=>{if(S.length>0){let v=[...S];if(v.length<4)for(;v.length<4;)v.unshift(v[0]),v.push(v[v.length-1]);for(let E=0;E<v.length-3;E++){let P=v[E],u=v[E+1],h=v[E+2],M=v[E+3];for(let C=0;C<=1;C+=.1){let I=C*C,k=I*C,R=.5*(2*u.x+(-P.x+h.x)*C+(2*P.x-5*u.x+4*h.x-M.x)*I+(-P.x+3*u.x-3*h.x+M.x)*k),A=.5*(2*u.y+(-P.y+h.y)*C+(2*P.y-5*u.y+4*h.y-M.y)*I+(-P.y+3*u.y-3*h.y+M.y)*k);b.push(R,A,e._fill,e._matrixIndex),m++}}}if(m<3)throw new Error("A shape must have at least 3 vertices.");if(x){let v=0,E=(m-1)*4,P=b[v],u=b[v+1],h=b[E],M=b[E+1];(P!==h||u!==M)&&(b.push(P,u,b[v+2],b[v+3]),m++)}if(e._doFill)if(m==5)f(b[0],b[1],b[2],b[3]),f(b[4],b[5],b[6],b[7]),f(b[12],b[13],b[14],b[15]),f(b[8],b[9],b[10],b[11]),r.push(0,4);else{for(let v=1;v<m-1;v++){let E=0,P=v*4,u=(v+1)*4;f(b[E],b[E+1],b[E+2],b[E+3]),f(b[P],b[P+1],b[P+2],b[P+3]),f(b[u],b[u+1],b[u+2],b[u+3])}r.push(0,(m-2)*3)}if(e._doStroke){let v=e._hsw,E=w(e._scaledSW),P=e._matrixIndex,u=e._strokeJoin;e._strokeJoin="none";for(let h=0;h<m-1;h++){let M=h*4,C=(h+1)*4;e.line(b[M],-b[M+1],b[C],-b[C+1]),_(b[M],b[M+1],v,v,0,s,E,e._stroke,P)}if(x){let h=(m-1)*4,M=0;e.line(b[h],-b[h+1],b[M],-b[M+1])}e._strokeJoin=u}m=0,b=[],S=[]},e.triangle=(x,v,E,P,u,h)=>{e.beginShape(),e.vertex(x,v),e.vertex(E,P),e.vertex(u,h),e.endShape(!0)},e.quad=(x,v,E,P,u,h,M,C)=>{e.beginShape(),e.vertex(x,v),e.vertex(E,P),e.vertex(u,h),e.vertex(M,C),e.endShape(!0)},e.background=(x,v,E,P)=>{if(e.push(),e.resetMatrix(),x.canvas){let u=x;e._imageMode="corner",e.image(u,-i.hw,-i.hh,i.w,i.h)}else e._rectMode="corner",e.fill(x,v,E,P),e._doStroke=!1,e.rect(-i.hw,-i.hh,i.w,i.h);e.pop()},e._hooks.preRender.push(()=>{e.pass.setPipeline(e._pipelines[0]);let x=n.device.createBuffer({size:a*4,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(x.getMappedRange()).set(t.slice(0,a)),x.unmap(),e.pass.setVertexBuffer(0,x)}),e._hooks.postRender.push(()=>{r=e.drawStack,a=0})},n.renderers.webgpu.image=(e,o)=>{let i=new Float32Array(1e7),r=0,t=n.device.createShaderModule({label:"imageShader",code:`
struct Uniforms {
	halfWidth: f32,
	halfHeight: f32
}
struct VertexParams {
	@location(0) pos: vec2f,
	@location(1) texCoord: vec2f,
	@location(2) tintIndex: f32,
	@location(3) matrixIndex: f32,
	@location(4) globalAlpha: f32
}
struct FragmentParams {
	@builtin(position) position: vec4f,
	@location(0) texCoord: vec2f,
	@location(1) tintIndex: f32,
	@location(2) globalAlpha: f32
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;
@group(0) @binding(1) var<storage> transforms: array<mat4x4<f32>>;
@group(0) @binding(2) var<storage> colors : array<vec4f>;

@group(1) @binding(0) var samp: sampler;
@group(1) @binding(1) var texture: texture_2d<f32>;

@vertex
fn vertexMain(v: VertexParams) -> FragmentParams {
	var vert = vec4f(v.pos, 0.0, 1.0);
	vert = transforms[i32(v.matrixIndex)] * vert;
	vert.x /= uniforms.halfWidth;
	vert.y /= uniforms.halfHeight;

	var f: FragmentParams;
	f.position = vert;
	f.texCoord = v.texCoord;
	f.tintIndex = v.tintIndex;
	f.globalAlpha = v.globalAlpha;
	return f;
}

@fragment
fn fragmentMain(f: FragmentParams) -> @location(0) vec4f {
		let texColor = textureSample(texture, samp, f.texCoord);
		let tintColor = colors[i32(f.tintIndex)];
		
		// Mix original and tinted colors using tint alpha as blend factor
		let tinted = vec4f(texColor.rgb * tintColor.rgb, texColor.a * f.globalAlpha);
		return mix(texColor, tinted, tintColor.a);
}
	`});e._textureBindGroups=[];let a=n.device.createBindGroupLayout({label:"textureLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d",sampleType:"float"}}]});const s={arrayStride:28,attributes:[{shaderLocation:0,offset:0,format:"float32x2"},{shaderLocation:1,offset:8,format:"float32x2"},{shaderLocation:2,offset:16,format:"float32"},{shaderLocation:3,offset:20,format:"float32"},{shaderLocation:4,offset:24,format:"float32"}]},d=n.device.createPipelineLayout({label:"imagePipelineLayout",bindGroupLayouts:[...e.bindGroupLayouts,a]});e._pipelineConfigs[1]={label:"imagePipeline",layout:d,vertex:{module:t,entryPoint:"vertexMain",buffers:[{arrayStride:0,attributes:[]},s]},fragment:{module:t,entryPoint:"fragmentMain",targets:[{format:"bgra8unorm",blend:e.blendConfigs.normal}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"},multisample:{count:4}},e._pipelines[1]=n.device.createRenderPipeline(e._pipelineConfigs[1]);let c,p=_=>{c=n.device.createSampler({magFilter:_,minFilter:_})};e.smooth=()=>p("linear"),e.noSmooth=()=>p("nearest"),e.smooth();let l=12e3;e._textures=[];let f=0;e._createTexture=_=>{_.canvas&&(_=_.canvas);let y=[_.width,_.height,1],w=n.device.createTexture({size:y,format:"bgra8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});n.device.queue.copyExternalImageToTexture({source:_},{texture:w,colorSpace:e.canvas.colorSpace},y),e._textures[f]=w,_.textureIndex=f;const m=n.device.createBindGroup({layout:a,entries:[{binding:0,resource:c},{binding:1,resource:w.createView()}]});e._textureBindGroups[f]=m,f=(f+1)%l,e._textures[f]&&(e._textures[f].destroy(),delete e._textures[f],delete e._textureBindGroups[f])},e.loadImage=(_,y)=>{o._preloadCount++;let w=e._g.loadImage(_,m=>{w.defaultWidth=m.width*e._defaultImageScale,w.defaultHeight=m.height*e._defaultImageScale,e._createTexture(m),o._preloadCount--,y&&y(w)});return w},e.imageMode=_=>e._imageMode=_;const g=(_,y,w,m,b,S,x)=>{let v=i,E=r;v[E++]=_,v[E++]=y,v[E++]=w,v[E++]=m,v[E++]=b,v[E++]=S,v[E++]=x,r=E};e.image=(_,y=0,w=0,m,b,S=0,x=0,v,E)=>{let P=_;if(_.canvas&&(_=_.canvas),_.textureIndex==null)return;e._matrixDirty&&e._saveMatrix();let u=_.width,h=_.height,M=P._pixelDensity||1;m??=P.defaultWidth,b??=P.defaultHeight,v??=u,E??=h,m*=M,b*=M;let[C,I,k,R]=e._calcBox(y,w,m,b,e._imageMode),A=S/u,T=x/h,O=(S+v)/u,F=(x+E)/h,L=e._matrixIndex,D=e._tint,B=e._globalAlpha;g(C,k,A,T,D,L,B),g(I,k,O,T,D,L,B),g(C,R,A,F,D,L,B),g(I,R,O,F,D,L,B),e.drawStack.push(1,_.textureIndex)},e._hooks.preRender.push(()=>{if(!e._textureBindGroups.length)return;e.pass.setPipeline(e._pipelines[1]);let _=n.device.createBuffer({size:r*5,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(_.getMappedRange()).set(i.slice(0,r)),_.unmap(),e.pass.setVertexBuffer(1,_)}),e._hooks.postRender.push(()=>{r=0})},n.THRESHOLD=1,n.GRAY=2,n.OPAQUE=3,n.INVERT=4,n.POSTERIZE=5,n.DILATE=6,n.ERODE=7,n.BLUR=8,n.renderers.webgpu.text=(e,o)=>{let i=n.device.createShaderModule({label:"MSDF text shader",code:`
struct Uniforms {
	halfWidth: f32,
	halfHeight: f32
}
struct VertexParams {
	@builtin(vertex_index) vertex : u32,
	@builtin(instance_index) instance : u32
}
struct FragmentParams {
	@builtin(position) position : vec4f,
	@location(0) texCoord : vec2f,
	@location(1) fillColor : vec4f
}
struct Char {
	texOffset: vec2f,
	texExtent: vec2f,
	size: vec2f,
	offset: vec2f,
}
struct Text {
	pos: vec2f,
	scale: f32,
	matrixIndex: f32,
	fillIndex: f32,
	strokeIndex: f32
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;
@group(0) @binding(1) var<storage> transforms: array<mat4x4<f32>>;
@group(0) @binding(2) var<storage> colors : array<vec4f>;

@group(1) @binding(0) var fontTexture: texture_2d<f32>;
@group(1) @binding(1) var fontSampler: sampler;
@group(1) @binding(2) var<storage> fontChars: array<Char>;

@group(2) @binding(0) var<storage> textChars: array<vec4f>;
@group(2) @binding(1) var<storage> textMetadata: array<Text>;

const quad = array(vec2f(0, -1), vec2f(1, -1), vec2f(0, 0), vec2f(1, 0));

@vertex
fn vertexMain(v : VertexParams) -> FragmentParams {
	let char = textChars[v.instance];

	let text = textMetadata[i32(char.w)];

	let fontChar = fontChars[i32(char.z)];

	let charPos = ((quad[v.vertex] * fontChar.size + char.xy + fontChar.offset) * text.scale) + text.pos;

	var vert = vec4f(charPos, 0.0, 1.0);
	vert = transforms[i32(text.matrixIndex)] * vert;
	vert.x /= uniforms.halfWidth;
	vert.y /= uniforms.halfHeight;

	var f : FragmentParams;
	f.position = vert;
	f.texCoord = (quad[v.vertex] * vec2f(1, -1)) * fontChar.texExtent + fontChar.texOffset;
	f.fillColor = colors[i32(text.fillIndex)];
	return f;
}

fn sampleMsdf(texCoord: vec2f) -> f32 {
	let c = textureSample(fontTexture, fontSampler, texCoord);
	return max(min(c.r, c.g), min(max(c.r, c.g), c.b));
}

@fragment
fn fragmentMain(f : FragmentParams) -> @location(0) vec4f {
	// pxRange (AKA distanceRange) comes from the msdfgen tool,
	// uses the default which is 4.
	let pxRange = 4.0;
	let sz = vec2f(textureDimensions(fontTexture, 0));
	let dx = sz.x*length(vec2f(dpdxFine(f.texCoord.x), dpdyFine(f.texCoord.x)));
	let dy = sz.y*length(vec2f(dpdxFine(f.texCoord.y), dpdyFine(f.texCoord.y)));
	let toPixels = pxRange * inverseSqrt(dx * dx + dy * dy);
	let sigDist = sampleMsdf(f.texCoord) - 0.5;
	let pxDist = sigDist * toPixels;
	let edgeWidth = 0.5;
	let alpha = smoothstep(-edgeWidth, edgeWidth, pxDist);
	if (alpha < 0.001) {
		discard;
	}
	return vec4f(f.fillColor.rgb, f.fillColor.a * alpha);
}
`}),r=n.device.createBindGroupLayout({label:"MSDF text group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),t=n.device.createSampler({minFilter:"linear",magFilter:"linear",mipmapFilter:"linear",maxAnisotropy:16}),a=n.device.createBindGroupLayout({label:"MSDF font group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),s=n.device.createPipelineLayout({bindGroupLayouts:[...e.bindGroupLayouts,a,r]});e._pipelineConfigs[2]={label:"msdf font pipeline",layout:s,vertex:{module:i,entryPoint:"vertexMain"},fragment:{module:i,entryPoint:"fragmentMain",targets:[{format:"bgra8unorm",blend:e.blendConfigs.normal}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"},multisample:{count:4}},e._pipelines[2]=n.device.createRenderPipeline(e._pipelineConfigs[2]);class d{constructor(b,S,x,v){this.bindGroup=b,this.lineHeight=S,this.chars=x,this.kernings=v;let E=Object.values(x);this.charCount=E.length,this.defaultChar=E[0]}getChar(b){return this.chars[b]??this.defaultChar}getXAdvance(b,S=-1){let x=this.getChar(b);if(S>=0){let v=this.kernings.get(b);if(v)return x.xadvance+(v.get(S)??0)}return x.xadvance}}e._fonts=[];let c={},p=async(m,b,S)=>{o._preloadCount++;let x=await fetch(m);if(x.status==404)return o._preloadCount--,"";let v=await x.json(),E=m.lastIndexOf("/"),P=E!=-1?m.substring(0,E+1):"";x=await fetch(P+v.pages[0]);let u=await createImageBitmap(await x.blob()),h=[u.width,u.height,1],M=n.device.createTexture({label:`MSDF ${b}`,size:h,format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});n.device.queue.copyExternalImageToTexture({source:u},{texture:M},h),typeof v.chars=="string"&&(v.chars=e.CSV.parse(v.chars," "),v.kernings=e.CSV.parse(v.kernings," "));let C=v.chars.length,I=n.device.createBuffer({size:C*32,usage:GPUBufferUsage.STORAGE,mappedAtCreation:!0}),k=new Float32Array(I.getMappedRange()),R=1/v.common.scaleW,A=1/v.common.scaleH,T={},O=0;for(let[D,B]of v.chars.entries())T[B.id]=B,T[B.id].charIndex=D,k[O]=B.x*R,k[O+1]=B.y*A,k[O+2]=B.width*R,k[O+3]=B.height*A,k[O+4]=B.width,k[O+5]=B.height,k[O+6]=B.xoffset,k[O+7]=-B.yoffset,O+=8;I.unmap();let F=n.device.createBindGroup({label:"msdf font bind group",layout:a,entries:[{binding:0,resource:M.createView()},{binding:1,resource:t},{binding:2,resource:{buffer:I}}]}),L=new Map;if(v.kernings)for(let D of v.kernings){let B=L.get(D.first);B||(B=new Map,L.set(D.first,B)),B.set(D.second,D.amount)}e._font=new d(F,v.common.lineHeight,T,L),e._font.index=e._fonts.length,e._fonts.push(e._font),c[b]=e._font,o._preloadCount--,S(b)};e._g.colorMode(e.RGB,1),e.loadFont=(m,b)=>{if(m.slice(m.lastIndexOf(".")+1)!="json")return e._g.loadFont(m,b);let x=m.slice(m.lastIndexOf("/")+1,m.lastIndexOf("-")),v={family:x};return v._loader=p(m,x,()=>{delete v._loader,b&&b(v)}),e._disablePreload?v._loader:v},e._loadDefaultFont=m=>{c[m]=null,navigator.onLine?e.loadFont(`https://q5js.org/fonts/${m}-msdf.json`):e.loadFont(`/node_modules/q5/builtinFonts/${m}-msdf.json`)},e._textSize=18,e._textAlign="left",e._textBaseline="alphabetic";let l=!1,f=22.5,g=1.25;e.textFont=m=>{typeof m!="string"&&(m=m.family);let b=c[m];b?e._font=b:b===void 0&&e._loadDefaultFont(m)},e.textSize=m=>{e._textSize=m,l||(f=m*g)},e.textLeading=m=>{e._font.lineHeight=f=m,f-e._textSize,g=f/e._textSize,l=!0},e.textAlign=(m,b)=>{e._textAlign=m,b&&(e._textBaseline=b)};let _=[],y=[],w=(m,b,S)=>{let x=0,v=0,E=0,P=0,u=0,h=[],M=b.charCodeAt(0);for(let C=0;C<b.length;++C){let I=M;switch(M=C<b.length-1?b.charCodeAt(C+1):-1,I){case 10:h.push(v),P++,x=Math.max(x,v),v=0,E-=m.lineHeight*g;break;case 13:break;case 32:v+=m.getXAdvance(I);break;case 9:v+=m.getXAdvance(I)*2;break;default:S&&S(v,E,P,m.getChar(I)),v+=m.getXAdvance(I,M),u++}}return h.push(v),x=Math.max(x,v),{width:x,height:h.length*m.lineHeight*g,lineWidths:h,printedCharCount:u}};e.text=(m,b,S,x,v)=>{if(!e._font){e._font!==null&&e.textFont("sans-serif");return}let E=typeof m;if(E!="string"&&(E=="object"?m=m.toString():m=m+""),m.length>x){let A=[],T=0;for(;T<m.length&&A.length<v;){let O=T+x;if(O>=m.length){A.push(m.slice(T));break}let F=m.lastIndexOf(" ",O);(F==-1||F<T)&&(F=O),A.push(m.slice(T,F)),T=F+1}m=A.join(`
`)}let P;for(let A=0;A<m.length;A++)switch(m[A]){case`
`:P=!0}let u=[],h=e._textAlign,M=e._textBaseline,C=y.length,I=0,k;if(h=="left"&&!P)k=w(e._font,m,(A,T,O,F)=>{u[I]=A,u[I+1]=T,u[I+2]=F.charIndex,u[I+3]=C,I+=4}),M=="alphabetic"?S-=e._textSize:M=="center"?S-=e._textSize*.5:M=="bottom"&&(S-=f);else{k=w(e._font,m);let A=0;M=="alphabetic"?S-=e._textSize:M=="center"?A=k.height*.5:M=="bottom"&&(A=k.height),w(e._font,m,(T,O,F,L)=>{let D=0;h=="center"?D=k.width*-.5-(k.width-k.lineWidths[F])*-.5:h=="right"&&(D=-k.lineWidths[F]),u[I]=T+D,u[I+1]=O+A,u[I+2]=L.charIndex,u[I+3]=C,I+=4})}_.push(u);let R=[];e._matrixDirty&&e._saveMatrix(),R[0]=b,R[1]=-S,R[2]=e._textSize/44,R[3]=e._matrixIndex,R[4]=e._fillSet?e._fill:0,R[5]=e._stroke,y.push(R),e.drawStack.push(2,k.printedCharCount,e._font.index)},e.textWidth=m=>e._font?w(e._font,m).width:0,e.createTextImage=(m,b,S)=>{if(e._g.textSize(e._textSize),e._doFill){let v=e._fill*4;e._g.fill(colorStack.slice(v,v+4))}if(e._doStroke){let v=e._stroke*4;e._g.stroke(colorStack.slice(v,v+4))}let x=e._g.createTextImage(m,b,S);if(x.canvas.textureIndex==null)e._createTexture(x);else if(x.modified){let v=x.canvas,E=[v.width,v.height,1],P=e._textures[v.textureIndex];n.device.queue.copyExternalImageToTexture({source:v},{texture:P,colorSpace:e.canvas.colorSpace},E),x.modified=!1}return x},e.textImage=(m,b,S)=>{typeof m=="string"&&(m=e.createTextImage(m));let x=e._imageMode;e._imageMode="corner";let v=e._textAlign;v=="center"?b-=m.canvas.hw:v=="right"&&(b-=m.width);let E=e._textBaseline;E=="alphabetic"?S-=m._leading:E=="center"?S-=m._middle:E=="bottom"?S-=m._bottom:E=="top"&&(S-=m._top),e.image(m,b,S),e._imageMode=x},e._hooks.preRender.push(()=>{if(!_.length)return;let m=0;for(let v of _)m+=v.length*4;let b=n.device.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(b.getMappedRange()).set(_.flat()),b.unmap();let S=y.length*6*4,x=n.device.createBuffer({label:"textBuffer",size:S,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(x.getMappedRange()).set(y.flat()),x.unmap(),e._textBindGroup=n.device.createBindGroup({label:"msdf text bind group",layout:r,entries:[{binding:0,resource:{buffer:b}},{binding:1,resource:{buffer:x}}]})}),e._hooks.postRender.push(()=>{_=[],y=[]})},Y}var ee;function re(){if(ee)return X.exports;ee=1;let n=!1;try{N.SkiaCanvas??=require("skia-canvas"),N.JSDOM??=require("jsdom").JSDOM,n=!0}catch{$(),X.exports=Q5}if(n){N.window=new JSDOM("",{url:"http://localhost"}).window;{let e=Object.getOwnPropertyNames(window).concat(Object.getOwnPropertyNames(Object.getPrototypeOf(window)));for(let o of e)N[o]||Object.defineProperty(N,o,Object.getOwnPropertyDescriptor(window,o));N.Event=window.Event}N.Image=window.Image=SkiaCanvas.Image,N.Window??=SkiaCanvas.Window,$(),Q5._createServerCanvas=function(){let e=new SkiaCanvas.Canvas(...arguments),o=document.createElement("canvas");return e.save=e.saveAsSync,new Proxy(e,{get:function(i,r){let t=r in i?i:o,a=t[r];return typeof a=="function"?a.bind(t):a},set:function(i,r,t){return r in i?i[r]=t:o[r]=t,!0}})},X.exports=Q5}return X.exports}var ie=re();const ne=te(ie);export{ne as q};
